// Global NDS space
//
// This goes along with wrapper_end.js to set up one big namespace for NDS. 

(function (){
    'use strict';

    (function(){
        // Undefine amd, requirejs, etc., because it conflicts with the local commonjs-require.

        var globals = typeof window !== 'undefined' ? window : global;

        globals.define = undefined;
        globals.require = undefined;
        globals.requirejs = undefined;

    }).call(this);

(function(){"use strict";var globals=typeof window!=="undefined"?window:global;if(typeof globals.require==="function")return;var modules={};var cache={};var has=function(object,name){return{}.hasOwnProperty.call(object,name)};var expand=function(root,name){var results=[],parts,part;if(/^\.\.?(\/|$)/.test(name)){parts=[root,name].join("/").split("/")}else{parts=name.split("/")}for(var i=0,length=parts.length;i<length;i++){part=parts[i];if(part===".."){results.pop()}else if(part!=="."&&part!==""){results.push(part)}}return results.join("/")};var dirname=function(path){return path.split("/").slice(0,-1).join("/")};var localRequire=function(path){return function(name){var dir=dirname(path);var absolute=expand(dir,name);return globals.require(absolute,path)}};var initModule=function(name,definition){var module={id:name,exports:{}};cache[name]=module;definition(module.exports,localRequire(name),module);return module.exports};var require=function(name,loaderPath){var path=expand(name,".");if(loaderPath==null)loaderPath="/";if(has(cache,path))return cache[path].exports;if(has(modules,path))return initModule(path,modules[path]);var dirIndex=expand(path,"./index");if(has(cache,dirIndex))return cache[dirIndex].exports;if(has(modules,dirIndex))return initModule(dirIndex,modules[dirIndex]);throw new Error('Cannot find module "'+name+'" from '+'"'+loaderPath+'"')};var define=function(bundle,fn){if(typeof bundle==="object"){for(var key in bundle){if(has(bundle,key)){modules[key]=bundle[key]}}}else{modules[bundle]=fn}};var list=function(){var result=[];for(var item in modules){if(has(modules,item)){result.push(item)}}return result};globals.require=require;globals.require.define=define;globals.require.register=define;globals.require.list=list;globals.require.brunch=true})();require.register({rangy:function(exports,require,module){(function(factory,global){if(typeof define=="function"&&define.amd){define(factory)}else if(typeof module!="undefined"&&typeof exports=="object"){module.exports=factory()}else{global.rangy=factory()}})(function(){var OBJECT="object",FUNCTION="function",UNDEFINED="undefined";var domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var textRangeMethods=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||!!(t==OBJECT&&o[p])||t=="unknown"}function isHostObject(o,p){return!!(typeof o[p]==OBJECT&&o[p])}function isHostProperty(o,p){return typeof o[p]!=UNDEFINED}function createMultiplePropertyTest(testFunc){return function(o,props){var i=props.length;while(i--){if(!testFunc(o,props[i])){return false}}return true}}var areHostMethods=createMultiplePropertyTest(isHostMethod);var areHostObjects=createMultiplePropertyTest(isHostObject);var areHostProperties=createMultiplePropertyTest(isHostProperty);function isTextRange(range){return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties)}function getBody(doc){return isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0]}var modules={};var isBrowser=typeof window!=UNDEFINED&&typeof document!=UNDEFINED;var util={isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties,isTextRange:isTextRange,getBody:getBody};var api={version:"1.3.0-alpha.20140825",initialized:false,isBrowser:isBrowser,supported:true,util:util,features:{},modules:modules,config:{alertOnFail:true,alertOnWarn:false,preferTextRange:false,autoInitialize:typeof rangyAutoInitialize==UNDEFINED?true:rangyAutoInitialize}};function consoleLog(msg){if(isHostObject(global,"console")&&isHostMethod(global.console,"log")){global.console.log(msg)}}function alertOrLog(msg,shouldAlert){if(isBrowser&&shouldAlert){alert(msg)}else{consoleLog(msg)}}function fail(reason){api.initialized=true;api.supported=false;alertOrLog("Rangy is not supported in this environment. Reason: "+reason,api.config.alertOnFail)}api.fail=fail;function warn(msg){alertOrLog("Rangy warning: "+msg,api.config.alertOnWarn)}api.warn=warn;var extend;if({}.hasOwnProperty){util.extend=extend=function(obj,props,deep){var o,p;for(var i in props){if(props.hasOwnProperty(i)){o=obj[i];p=props[i];if(deep&&o!==null&&typeof o=="object"&&p!==null&&typeof p=="object"){extend(o,p,true)}obj[i]=p}}if(props.hasOwnProperty("toString")){obj.toString=props.toString}return obj};util.createOptions=function(optionsParam,defaults){var options={};extend(options,defaults);if(optionsParam){extend(options,optionsParam,true)}return options}}else{fail("hasOwnProperty not supported")}if(!isBrowser){fail("Rangy can only run in a browser")}(function(){var toArray;if(isBrowser){var el=document.createElement("div");el.appendChild(document.createElement("span"));var slice=[].slice;try{if(slice.call(el.childNodes,0)[0].nodeType==1){toArray=function(arrayLike){return slice.call(arrayLike,0)}}}catch(e){}}if(!toArray){toArray=function(arrayLike){var arr=[];for(var i=0,len=arrayLike.length;i<len;++i){arr[i]=arrayLike[i]}return arr}}util.toArray=toArray})();var addListener;if(isBrowser){if(isHostMethod(document,"addEventListener")){addListener=function(obj,eventType,listener){obj.addEventListener(eventType,listener,false)}}else if(isHostMethod(document,"attachEvent")){addListener=function(obj,eventType,listener){obj.attachEvent("on"+eventType,listener)}}else{fail("Document does not have required addEventListener or attachEvent method")}util.addListener=addListener}var initListeners=[];function getErrorDesc(ex){return ex.message||ex.description||String(ex)}function init(){if(!isBrowser||api.initialized){return}var testRange;var implementsDomRange=false,implementsTextRange=false;if(isHostMethod(document,"createRange")){testRange=document.createRange();if(areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)){implementsDomRange=true}}var body=getBody(document);if(!body||body.nodeName.toLowerCase()!="body"){fail("No body element found");return}if(body&&isHostMethod(body,"createTextRange")){testRange=body.createTextRange();if(isTextRange(testRange)){implementsTextRange=true}}if(!implementsDomRange&&!implementsTextRange){fail("Neither Range nor TextRange are available");return}api.initialized=true;api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var module,errorMessage;for(var moduleName in modules){if((module=modules[moduleName])instanceof Module){module.init(module,api)}}for(var i=0,len=initListeners.length;i<len;++i){try{initListeners[i](api)}catch(ex){errorMessage="Rangy init listener threw an exception. Continuing. Detail: "+getErrorDesc(ex);consoleLog(errorMessage)}}}api.init=init;api.addInitListener=function(listener){if(api.initialized){listener(api)}else{initListeners.push(listener)}};var shimListeners=[];api.addShimListener=function(listener){shimListeners.push(listener)};function shim(win){win=win||window;init();for(var i=0,len=shimListeners.length;i<len;++i){shimListeners[i](win)}}if(isBrowser){api.shim=api.createMissingNativeApi=shim}function Module(name,dependencies,initializer){this.name=name;this.dependencies=dependencies;this.initialized=false;this.supported=false;this.initializer=initializer}Module.prototype={init:function(){var requiredModuleNames=this.dependencies||[];for(var i=0,len=requiredModuleNames.length,requiredModule,moduleName;i<len;++i){moduleName=requiredModuleNames[i];requiredModule=modules[moduleName];if(!requiredModule||!(requiredModule instanceof Module)){throw new Error("required module '"+moduleName+"' not found")}requiredModule.init();if(!requiredModule.supported){throw new Error("required module '"+moduleName+"' not supported")}}this.initializer(this)},fail:function(reason){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+reason)},warn:function(msg){api.warn("Module "+this.name+": "+msg)},deprecationNotice:function(deprecated,replacement){api.warn("DEPRECATED: "+deprecated+" in module "+this.name+"is deprecated. Please use "+replacement+" instead")},createError:function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg)}};function createModule(name,dependencies,initFunc){var newModule=new Module(name,dependencies,function(module){if(!module.initialized){module.initialized=true;try{initFunc(api,module);module.supported=true}catch(ex){var errorMessage="Module '"+name+"' failed to load: "+getErrorDesc(ex);consoleLog(errorMessage)}}});modules[name]=newModule;return newModule}api.createModule=function(name){var initFunc,dependencies;if(arguments.length==2){initFunc=arguments[1];dependencies=[]}else{initFunc=arguments[2];dependencies=arguments[1]}var module=createModule(name,dependencies,initFunc);if(api.initialized&&api.supported){module.init()}};api.createCoreModule=function(name,dependencies,initFunc){createModule(name,dependencies,initFunc)};function RangePrototype(){}api.RangePrototype=RangePrototype;api.rangePrototype=new RangePrototype;function SelectionPrototype(){}api.selectionPrototype=new SelectionPrototype;api.createCoreModule("DomUtil",[],function(api,module){var UNDEF="undefined";var util=api.util;if(!util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){module.fail("document missing a Node creation method")}if(!util.isHostMethod(document,"getElementsByTagName")){module.fail("document missing getElementsByTagName method")}var el=document.createElement("div");if(!util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))){module.fail("Incomplete Element implementation")}if(!util.isHostProperty(el,"innerHTML")){module.fail("Element is missing innerHTML property")}var textNode=document.createTextNode("test");if(!util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))){module.fail("Incomplete Text Node implementation")}var arrayContains=function(arr,val){var i=arr.length;while(i--){if(arr[i]===val){return true}}return false};function isHtmlNamespace(node){var ns;return typeof node.namespaceURI==UNDEF||((ns=node.namespaceURI)===null||ns=="http://www.w3.org/1999/xhtml")}function parentElement(node){var parent=node.parentNode;return parent.nodeType==1?parent:null}function getNodeIndex(node){var i=0;while(node=node.previousSibling){++i}return i}function getNodeLength(node){switch(node.nodeType){case 7:case 10:return 0;case 3:case 8:return node.length;default:return node.childNodes.length}}function getCommonAncestor(node1,node2){var ancestors=[],n;for(n=node1;n;n=n.parentNode){ancestors.push(n)}for(n=node2;n;n=n.parentNode){if(arrayContains(ancestors,n)){return n}}return null}function isAncestorOf(ancestor,descendant,selfIsAncestor){var n=selfIsAncestor?descendant:descendant.parentNode;while(n){if(n===ancestor){return true}else{n=n.parentNode}}return false}function isOrIsAncestorOf(ancestor,descendant){return isAncestorOf(ancestor,descendant,true)}function getClosestAncestorIn(node,ancestor,selfIsAncestor){var p,n=selfIsAncestor?node:node.parentNode;while(n){p=n.parentNode;if(p===ancestor){return n}n=p}return null}function isCharacterDataNode(node){var t=node.nodeType;return t==3||t==4||t==8}function isTextOrCommentNode(node){if(!node){return false}var t=node.nodeType;return t==3||t==8}function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;if(nextNode){parent.insertBefore(node,nextNode)}else{parent.appendChild(node)}return node}function splitDataNode(node,index,positionsToPreserve){var newNode=node.cloneNode(false);newNode.deleteData(0,index);node.deleteData(index,node.length-index);insertAfter(newNode,node);if(positionsToPreserve){for(var i=0,position;position=positionsToPreserve[i++];){if(position.node==node&&position.offset>index){position.node=newNode;position.offset-=index}else if(position.node==node.parentNode&&position.offset>getNodeIndex(node)){++position.offset}}}return newNode}function getDocument(node){if(node.nodeType==9){return node}else if(typeof node.ownerDocument!=UNDEF){return node.ownerDocument}else if(typeof node.document!=UNDEF){return node.document}else if(node.parentNode){return getDocument(node.parentNode)}else{throw module.createError("getDocument: no document found for node")}}function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF){return doc.defaultView}else if(typeof doc.parentWindow!=UNDEF){return doc.parentWindow}else{throw module.createError("Cannot get a window object for node")}}function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument}else if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow.document}else{throw module.createError("getIframeDocument: No Document object found for iframe element")}}function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow}else if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument.defaultView}else{throw module.createError("getIframeWindow: No Window object found for iframe element")}}function isWindow(obj){return obj&&util.isHostMethod(obj,"setTimeout")&&util.isHostObject(obj,"document")}function getContentDocument(obj,module,methodName){var doc;if(!obj){doc=document}else if(util.isHostProperty(obj,"nodeType")){doc=obj.nodeType==1&&obj.tagName.toLowerCase()=="iframe"?getIframeDocument(obj):getDocument(obj)}else if(isWindow(obj)){doc=obj.document}if(!doc){throw module.createError(methodName+"(): Parameter must be a Window object or DOM node")}return doc}function getRootContainer(node){var parent;while(parent=node.parentNode){node=parent}return node}function comparePoints(nodeA,offsetA,nodeB,offsetB){var nodeC,root,childA,childB,n;if(nodeA==nodeB){return offsetA===offsetB?0:offsetA<offsetB?-1:1}else if(nodeC=getClosestAncestorIn(nodeB,nodeA,true)){return offsetA<=getNodeIndex(nodeC)?-1:1}else if(nodeC=getClosestAncestorIn(nodeA,nodeB,true)){return getNodeIndex(nodeC)<offsetB?-1:1}else{root=getCommonAncestor(nodeA,nodeB);if(!root){throw new Error("comparePoints error: nodes have no common ancestor")}childA=nodeA===root?root:getClosestAncestorIn(nodeA,root,true);childB=nodeB===root?root:getClosestAncestorIn(nodeB,root,true);if(childA===childB){throw module.createError("comparePoints got to case 4 and childA and childB are the same!")}else{n=root.firstChild;while(n){if(n===childA){return-1}else if(n===childB){return 1}n=n.nextSibling}}}}var crashyTextNodes=false;function isBrokenNode(node){var n;try{n=node.parentNode;return false}catch(e){return true}}(function(){var el=document.createElement("b");el.innerHTML="1";var textNode=el.firstChild;el.innerHTML="<br>";crashyTextNodes=isBrokenNode(textNode);api.features.crashyTextNodes=crashyTextNodes})();function inspectNode(node){if(!node){return"[No node]"}if(crashyTextNodes&&isBrokenNode(node)){return"[Broken node]"}if(isCharacterDataNode(node)){return'"'+node.data+'"'}if(node.nodeType==1){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">[index:"+getNodeIndex(node)+",length:"+node.childNodes.length+"]["+(node.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return node.nodeName}function fragmentFromNodeChildren(node){var fragment=getDocument(node).createDocumentFragment(),child;while(child=node.firstChild){fragment.appendChild(child)}return fragment}var getComputedStyleProperty;if(typeof window.getComputedStyle!=UNDEF){getComputedStyleProperty=function(el,propName){return getWindow(el).getComputedStyle(el,null)[propName]}}else if(typeof document.documentElement.currentStyle!=UNDEF){getComputedStyleProperty=function(el,propName){return el.currentStyle[propName]}}else{module.fail("No means of obtaining computed style properties found")}function NodeIterator(root){this.root=root;this._next=root}NodeIterator.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;var child,next;if(this._current){child=n.firstChild;if(child){this._next=child}else{next=null;while(n!==this.root&&!(next=n.nextSibling)){n=n.parentNode}this._next=next}}return this._current},detach:function(){this._current=this._next=this.root=null}};function createIterator(root){return new NodeIterator(root)}function DomPosition(node,offset){this.node=node;this.offset=offset}DomPosition.prototype={equals:function(pos){return!!pos&&this.node===pos.node&&this.offset==pos.offset},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function DOMException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="DOMException: "+this.codeName}DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};DOMException.prototype.toString=function(){return this.message};api.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,isOrIsAncestorOf:isOrIsAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,isTextOrCommentNode:isTextOrCommentNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:util.getBody,isWindow:isWindow,getContentDocument:getContentDocument,getRootContainer:getRootContainer,comparePoints:comparePoints,isBrokenNode:isBrokenNode,inspectNode:inspectNode,getComputedStyleProperty:getComputedStyleProperty,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition};api.DOMException=DOMException});api.createCoreModule("DomRange",["DomUtil"],function(api,module){var dom=api.dom;var util=api.util;var DomPosition=dom.DomPosition;var DOMException=api.DOMException;var isCharacterDataNode=dom.isCharacterDataNode;var getNodeIndex=dom.getNodeIndex;var isOrIsAncestorOf=dom.isOrIsAncestorOf;var getDocument=dom.getDocument;var comparePoints=dom.comparePoints;var splitDataNode=dom.splitDataNode;var getClosestAncestorIn=dom.getClosestAncestorIn;var getNodeLength=dom.getNodeLength;var arrayContains=dom.arrayContains;var getRootContainer=dom.getRootContainer;var crashyTextNodes=api.features.crashyTextNodes;function isNonTextPartiallySelected(node,range){return node.nodeType!=3&&(isOrIsAncestorOf(node,range.startContainer)||isOrIsAncestorOf(node,range.endContainer))}function getRangeDocument(range){return range.document||getDocument(range.startContainer)}function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,getNodeIndex(node))}function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,getNodeIndex(node)+1)}function insertNodeAtPosition(node,n,o){var firstNodeInserted=node.nodeType==11?node.firstChild:node;if(isCharacterDataNode(n)){if(o==n.length){dom.insertAfter(node,n)}else{n.parentNode.insertBefore(node,o==0?n:splitDataNode(n,o))}}else if(o>=n.childNodes.length){n.appendChild(node)}else{n.insertBefore(node,n.childNodes[o])}return firstNodeInserted}function rangesIntersect(rangeA,rangeB,touchingIsIntersecting){assertRangeValid(rangeA);assertRangeValid(rangeB);if(getRangeDocument(rangeB)!=getRangeDocument(rangeA)){throw new DOMException("WRONG_DOCUMENT_ERR")}var startComparison=comparePoints(rangeA.startContainer,rangeA.startOffset,rangeB.endContainer,rangeB.endOffset),endComparison=comparePoints(rangeA.endContainer,rangeA.endOffset,rangeB.startContainer,rangeB.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0}function cloneSubtree(iterator){var partiallySelected;for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){partiallySelected=iterator.isPartiallySelectedSubtree();node=node.cloneNode(!partiallySelected);if(partiallySelected){subIterator=iterator.getSubtreeIterator();node.appendChild(cloneSubtree(subIterator));subIterator.detach()}if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR")}frag.appendChild(node)}return frag}function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:false};for(var node,subRangeIterator;node=rangeIterator.next();){if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===false){iteratorState.stop=true;return}else{subRangeIterator=rangeIterator.getSubtreeIterator();iterateSubtree(subRangeIterator,func,iteratorState);subRangeIterator.detach();if(iteratorState.stop){return}}}else{it=dom.createIterator(node);while(n=it.next()){if(func(n)===false){iteratorState.stop=true;return}}}}}function deleteSubtree(iterator){var subIterator;while(iterator.next()){if(iterator.isPartiallySelectedSubtree()){subIterator=iterator.getSubtreeIterator();deleteSubtree(subIterator);subIterator.detach()}else{iterator.remove()}}}function extractSubtree(iterator){for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){if(iterator.isPartiallySelectedSubtree()){node=node.cloneNode(false);subIterator=iterator.getSubtreeIterator();node.appendChild(extractSubtree(subIterator));subIterator.detach()}else{iterator.remove()}if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR")}frag.appendChild(node)}return frag}function getNodesInRange(range,nodeTypes,filter){var filterNodeTypes=!!(nodeTypes&&nodeTypes.length),regex;var filterExists=!!filter;if(filterNodeTypes){regex=new RegExp("^("+nodeTypes.join("|")+")$")}var nodes=[];iterateSubtree(new RangeIterator(range,false),function(node){if(filterNodeTypes&&!regex.test(node.nodeType)){return}if(filterExists&&!filter(node)){return}var sc=range.startContainer;if(node==sc&&isCharacterDataNode(sc)&&range.startOffset==sc.length){return}var ec=range.endContainer;if(node==ec&&isCharacterDataNode(ec)&&range.endOffset==0){return}nodes.push(node)});return nodes}function inspect(range){var name=typeof range.getName=="undefined"?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+dom.inspectNode(range.endContainer)+":"+range.endOffset+")]"}function RangeIterator(range,clonePartiallySelectedTextNodes){this.range=range;this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes;if(!range.collapsed){this.sc=range.startContainer;this.so=range.startOffset;this.ec=range.endContainer;this.eo=range.endOffset;var root=range.commonAncestorContainer;if(this.sc===this.ec&&isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===root&&!isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:getClosestAncestorIn(this.sc,root,true);this._last=this.ec===root&&!isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:getClosestAncestorIn(this.ec,root,true)}}}RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var current=this._current=this._next;if(current){this._next=current!==this._last?current.nextSibling:null;if(isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes){if(current===this.ec){(current=current.cloneNode(true)).deleteData(this.eo,current.length-this.eo)}if(this._current===this.sc){(current=current.cloneNode(true)).deleteData(0,this.so)}}}return current},remove:function(){var current=this._current,start,end;if(isCharacterDataNode(current)&&(current===this.sc||current===this.ec)){start=current===this.sc?this.so:0;end=current===this.ec?this.eo:current.length;if(start!=end){current.deleteData(start,end-start)}}else{if(current.parentNode){current.parentNode.removeChild(current)}else{}}},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range)},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode){subRange=this.range.cloneRange();subRange.collapse(false)}else{subRange=new Range(getRangeDocument(this.range));var current=this._current;var startContainer=current,startOffset=0,endContainer=current,endOffset=getNodeLength(current);if(isOrIsAncestorOf(current,this.sc)){startContainer=this.sc;startOffset=this.so}if(isOrIsAncestorOf(current,this.ec)){endContainer=this.ec;endOffset=this.eo}updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset)}return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var beforeAfterNodeTypes=[1,3,4,5,7,8,10];var rootContainerNodeTypes=[2,9,11];var readonlyNodeTypes=[5,6,10,12];var insertableNodeTypes=[1,3,4,5,7,8,10,11];var surroundNodeTypes=[1,3,4,5,7,8];function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){var t,n=selfIsAncestor?node:node.parentNode;while(n){t=n.nodeType;if(arrayContains(nodeTypes,t)){return n}n=n.parentNode}return null}}var getDocumentOrFragmentContainer=createAncestorFinder([9,11]);var getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes);var getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]);function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf)){throw new DOMException("INVALID_NODE_TYPE_ERR")}}function assertValidNodeType(node,invalidTypes){if(!arrayContains(invalidTypes,node.nodeType)){throw new DOMException("INVALID_NODE_TYPE_ERR")}}function assertValidOffset(node,offset){if(offset<0||offset>(isCharacterDataNode(node)?node.length:node.childNodes.length)){throw new DOMException("INDEX_SIZE_ERR")}}function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,true)!==getDocumentOrFragmentContainer(node2,true)){throw new DOMException("WRONG_DOCUMENT_ERR")}}function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,true)){throw new DOMException("NO_MODIFICATION_ALLOWED_ERR")}}function assertNode(node,codeName){if(!node){throw new DOMException(codeName)}}function isOrphan(node){return crashyTextNodes&&dom.isBrokenNode(node)||!arrayContains(rootContainerNodeTypes,node.nodeType)&&!getDocumentOrFragmentContainer(node,true)}function isValidOffset(node,offset){return offset<=(isCharacterDataNode(node)?node.length:node.childNodes.length)}function isRangeValid(range){return!!range.startContainer&&!!range.endContainer&&!isOrphan(range.startContainer)&&!isOrphan(range.endContainer)&&isValidOffset(range.startContainer,range.startOffset)&&isValidOffset(range.endContainer,range.endOffset)}function assertRangeValid(range){if(!isRangeValid(range)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")")}}var styleEl=document.createElement("style");var htmlParsingConforms=false;try{styleEl.innerHTML="<b>x</b>";htmlParsingConforms=styleEl.firstChild.nodeType==3}catch(e){}api.features.htmlParsingConforms=htmlParsingConforms;var createContextualFragment=htmlParsingConforms?function(fragmentStr){var node=this.startContainer;var doc=getDocument(node);if(!node){throw new DOMException("INVALID_STATE_ERR")}var el=null;if(node.nodeType==1){el=node}else if(isCharacterDataNode(node)){el=dom.parentElement(node)}if(el===null||el.nodeName=="HTML"&&dom.isHtmlNamespace(getDocument(el).documentElement)&&dom.isHtmlNamespace(el)){el=doc.createElement("body")}else{el=el.cloneNode(false)}el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el)}:function(fragmentStr){var doc=getRangeDocument(this);var el=doc.createElement("body");el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el)};function splitRangeBoundaries(range,positionsToPreserve){assertRangeValid(range);var sc=range.startContainer,so=range.startOffset,ec=range.endContainer,eo=range.endOffset;var startEndSame=sc===ec;if(isCharacterDataNode(ec)&&eo>0&&eo<ec.length){splitDataNode(ec,eo,positionsToPreserve)}if(isCharacterDataNode(sc)&&so>0&&so<sc.length){sc=splitDataNode(sc,so,positionsToPreserve);if(startEndSame){eo-=so;ec=sc}else if(ec==sc.parentNode&&eo>=getNodeIndex(sc)){eo++}so=0}range.setStartAndEnd(sc,so,ec,eo)}function rangeToHtml(range){assertRangeValid(range);var container=range.commonAncestorContainer.parentNode.cloneNode(false);container.appendChild(range.cloneContents());return container.innerHTML}var rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var s2s=0,s2e=1,e2e=2,e2s=3;var n_b=0,n_a=1,n_b_a=2,n_i=3;util.extend(api.rangePrototype,{compareBoundaryPoints:function(how,range){assertRangeValid(this);assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB;var prefixA=how==e2s||how==s2s?"start":"end";var prefixB=how==s2e||how==s2s?"start":"end";nodeA=this[prefixA+"Container"];offsetA=this[prefixA+"Offset"];nodeB=range[prefixB+"Container"];offsetB=range[prefixB+"Offset"];return comparePoints(nodeA,offsetA,nodeB,offsetB)},insertNode:function(node){assertRangeValid(this);assertValidNodeType(node,insertableNodeTypes);assertNodeNotReadOnly(this.startContainer);if(isOrIsAncestorOf(node,this.startContainer)){throw new DOMException("HIERARCHY_REQUEST_ERR")}var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted)},cloneContents:function(){assertRangeValid(this);var clone,frag;if(this.collapsed){return getRangeDocument(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&isCharacterDataNode(this.startContainer)){clone=this.startContainer.cloneNode(true);clone.data=clone.data.slice(this.startOffset,this.endOffset);frag=getRangeDocument(this).createDocumentFragment();frag.appendChild(clone);return frag}else{var iterator=new RangeIterator(this,true);clone=cloneSubtree(iterator);iterator.detach()}return clone}},canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);iterator.detach();return!boundariesInvalid},surroundContents:function(node){assertValidNodeType(node,surroundNodeTypes);if(!this.canSurroundContents()){throw new DOMException("INVALID_STATE_ERR")}var content=this.extractContents();if(node.hasChildNodes()){while(node.lastChild){node.removeChild(node.lastChild)}}insertNodeAtPosition(node,this.startContainer,this.startOffset);node.appendChild(content);this.selectNode(node)},cloneRange:function(){assertRangeValid(this);var range=new Range(getRangeDocument(this));var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=this[prop]}return range},toString:function(){assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&isCharacterDataNode(sc)){return sc.nodeType==3||sc.nodeType==4?sc.data.slice(this.startOffset,this.endOffset):"";

}else{var textParts=[],iterator=new RangeIterator(this,true);iterateSubtree(iterator,function(node){if(node.nodeType==3||node.nodeType==4){textParts.push(node.data)}});iterator.detach();return textParts.join("")}},compareNode:function(node){assertRangeValid(this);var parent=node.parentNode;var nodeIndex=getNodeIndex(node);if(!parent){throw new DOMException("NOT_FOUND_ERR")}var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);if(startComparison<0){return endComparison>0?n_b_a:n_b}else{return endComparison>0?n_a:n_i}},comparePoint:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);if(comparePoints(node,offset,this.startContainer,this.startOffset)<0){return-1}else if(comparePoints(node,offset,this.endContainer,this.endOffset)>0){return 1}return 0},createContextualFragment:createContextualFragment,toHtml:function(){return rangeToHtml(this)},intersectsNode:function(node,touchingIsIntersecting){assertRangeValid(this);assertNode(node,"NOT_FOUND_ERR");if(getDocument(node)!==getRangeDocument(this)){return false}var parent=node.parentNode,offset=getNodeIndex(node);assertNode(parent,"NOT_FOUND_ERR");var startComparison=comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0},isPointInRange:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);return comparePoints(node,offset,this.startContainer,this.startOffset)>=0&&comparePoints(node,offset,this.endContainer,this.endOffset)<=0},intersectsRange:function(range){return rangesIntersect(this,range,false)},intersectsOrTouchesRange:function(range){return rangesIntersect(this,range,true)},intersection:function(range){if(this.intersectsRange(range)){var startComparison=comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset);var intersectionRange=this.cloneRange();if(startComparison==-1){intersectionRange.setStart(range.startContainer,range.startOffset)}if(endComparison==1){intersectionRange.setEnd(range.endContainer,range.endOffset)}return intersectionRange}return null},union:function(range){if(this.intersectsOrTouchesRange(range)){var unionRange=this.cloneRange();if(comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)==-1){unionRange.setStart(range.startContainer,range.startOffset)}if(comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)==1){unionRange.setEnd(range.endContainer,range.endOffset)}return unionRange}else{throw new DOMException("Ranges do not intersect")}},containsNode:function(node,allowPartial){if(allowPartial){return this.intersectsNode(node,false)}else{return this.compareNode(node)==n_i}},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,getNodeLength(node))<=0},containsRange:function(range){var intersection=this.intersection(range);return intersection!==null&&range.equals(intersection)},containsNodeText:function(node){var nodeRange=this.cloneRange();nodeRange.selectNode(node);var textNodes=nodeRange.getNodes([3]);if(textNodes.length>0){nodeRange.setStart(textNodes[0],0);var lastTextNode=textNodes.pop();nodeRange.setEnd(lastTextNode,lastTextNode.length);return this.containsRange(nodeRange)}else{return this.containsNodeContents(node)}},getNodes:function(nodeTypes,filter){assertRangeValid(this);return getNodesInRange(this,nodeTypes,filter)},getDocument:function(){return getRangeDocument(this)},collapseBefore:function(node){this.setEndBefore(node);this.collapse(false)},collapseAfter:function(node){this.setStartAfter(node);this.collapse(true)},getBookmark:function(containerNode){var doc=getRangeDocument(this);var preSelectionRange=api.createRange(doc);containerNode=containerNode||dom.getBody(doc);preSelectionRange.selectNodeContents(containerNode);var range=this.intersection(preSelectionRange);var start=0,end=0;if(range){preSelectionRange.setEnd(range.startContainer,range.startOffset);start=preSelectionRange.toString().length;end=start+range.toString().length}return{start:start,end:end,containerNode:containerNode}},moveToBookmark:function(bookmark){var containerNode=bookmark.containerNode;var charIndex=0;this.setStart(containerNode,0);this.collapse(true);var nodeStack=[containerNode],node,foundStart=false,stop=false;var nextCharIndex,i,childNodes;while(!stop&&(node=nodeStack.pop())){if(node.nodeType==3){nextCharIndex=charIndex+node.length;if(!foundStart&&bookmark.start>=charIndex&&bookmark.start<=nextCharIndex){this.setStart(node,bookmark.start-charIndex);foundStart=true}if(foundStart&&bookmark.end>=charIndex&&bookmark.end<=nextCharIndex){this.setEnd(node,bookmark.end-charIndex);stop=true}charIndex=nextCharIndex}else{childNodes=node.childNodes;i=childNodes.length;while(i--){nodeStack.push(childNodes[i])}}}},getName:function(){return"DomRange"},equals:function(range){return Range.rangesEqual(this,range)},isValid:function(){return isRangeValid(this)},inspect:function(){return inspect(this)},detach:function(){}});function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s;obj.START_TO_END=s2e;obj.END_TO_END=e2e;obj.END_TO_START=e2s;obj.NODE_BEFORE=n_b;obj.NODE_AFTER=n_a;obj.NODE_BEFORE_AND_AFTER=n_b_a;obj.NODE_INSIDE=n_i}function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor);copyComparisonConstantsToObject(constructor.prototype)}function createRangeContentRemover(remover,boundaryUpdater){return function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer;var iterator=new RangeIterator(this,true);var node,boundary;if(sc!==root){node=getClosestAncestorIn(sc,root,true);boundary=getBoundaryAfterNode(node);sc=boundary.node;so=boundary.offset}iterateSubtree(iterator,assertNodeNotReadOnly);iterator.reset();var returnValue=remover(iterator);iterator.detach();boundaryUpdater(this,sc,so,sc,so);return returnValue}}function createPrototypeRange(constructor,boundaryUpdater){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertValidNodeType(node,beforeAfterNodeTypes);assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset)}}function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;if(node!==range.startContainer||offset!==range.startOffset){if(getRootContainer(node)!=getRootContainer(ec)||comparePoints(node,offset,ec,eo)==1){ec=node;eo=offset}boundaryUpdater(range,node,offset,ec,eo)}}function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;if(node!==range.endContainer||offset!==range.endOffset){if(getRootContainer(node)!=getRootContainer(sc)||comparePoints(node,offset,sc,so)==-1){sc=node;so=offset}boundaryUpdater(range,sc,so,node,offset)}}var F=function(){};F.prototype=api.rangePrototype;constructor.prototype=new F;util.extend(constructor.prototype,{setStart:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStart(this,node,offset)},setEnd:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeEnd(this,node,offset)},setStartAndEnd:function(){var args=arguments;var sc=args[0],so=args[1],ec=sc,eo=so;switch(args.length){case 3:eo=args[2];break;case 4:ec=args[2];eo=args[3];break}boundaryUpdater(this,sc,so,ec,eo)},setBoundary:function(node,offset,isStart){this["set"+(isStart?"Start":"End")](node,offset)},setStartBefore:createBeforeAfterNodeSetter(true,true),setStartAfter:createBeforeAfterNodeSetter(false,true),setEndBefore:createBeforeAfterNodeSetter(true,false),setEndAfter:createBeforeAfterNodeSetter(false,false),collapse:function(isStart){assertRangeValid(this);if(isStart){boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(node){assertNoDocTypeNotationEntityAncestor(node,true);boundaryUpdater(this,node,0,node,getNodeLength(node))},selectNode:function(node){assertNoDocTypeNotationEntityAncestor(node,false);assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset)},extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);iterator.detach();return!boundariesInvalid},splitBoundaries:function(){splitRangeBoundaries(this)},splitBoundariesPreservingPositions:function(positionsToPreserve){splitRangeBoundaries(this,positionsToPreserve)},normalizeBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var mergeForward=function(node){var sibling=node.nextSibling;if(sibling&&sibling.nodeType==node.nodeType){ec=node;eo=node.length;node.appendData(sibling.data);sibling.parentNode.removeChild(sibling)}};var mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;var nodeLength=node.length;so=sibling.length;node.insertData(0,sibling.data);sibling.parentNode.removeChild(sibling);if(sc==ec){eo+=so;ec=sc}else if(ec==node.parentNode){var nodeIndex=getNodeIndex(node);if(eo==nodeIndex){ec=node;eo=nodeLength}else if(eo>nodeIndex){eo--}}}};var normalizeStart=true;if(isCharacterDataNode(ec)){if(ec.length==eo){mergeForward(ec)}}else{if(eo>0){var endNode=ec.childNodes[eo-1];if(endNode&&isCharacterDataNode(endNode)){mergeForward(endNode)}}normalizeStart=!this.collapsed}if(normalizeStart){if(isCharacterDataNode(sc)){if(so==0){mergeBackward(sc)}}else{if(so<sc.childNodes.length){var startNode=sc.childNodes[so];if(startNode&&isCharacterDataNode(startNode)){mergeBackward(startNode)}}}}else{sc=ec;so=eo}boundaryUpdater(this,sc,so,ec,eo)},collapseToPoint:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);this.setStartAndEnd(node,offset)}});copyComparisonConstants(constructor)}function updateCollapsedAndCommonAncestor(range){range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset;range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer)}function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){range.startContainer=startContainer;range.startOffset=startOffset;range.endContainer=endContainer;range.endOffset=endOffset;range.document=dom.getDocument(startContainer);updateCollapsedAndCommonAncestor(range)}function Range(doc){this.startContainer=doc;this.startOffset=0;this.endContainer=doc;this.endOffset=0;this.document=doc;updateCollapsedAndCommonAncestor(this)}createPrototypeRange(Range,updateBoundaries);util.extend(Range,{rangeProperties:rangeProperties,RangeIterator:RangeIterator,copyComparisonConstants:copyComparisonConstants,createPrototypeRange:createPrototypeRange,inspect:inspect,toHtml:rangeToHtml,getRangeDocument:getRangeDocument,rangesEqual:function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset}});api.DomRange=Range});api.createCoreModule("WrappedRange",["DomRange"],function(api,module){var WrappedRange,WrappedTextRange;var dom=api.dom;var util=api.util;var DomPosition=dom.DomPosition;var DomRange=api.DomRange;var getBody=dom.getBody;var getContentDocument=dom.getContentDocument;var isCharacterDataNode=dom.isCharacterDataNode;if(api.features.implementsDomRange){(function(){var rangeProto;var rangeProperties=DomRange.rangeProperties;function updateRangeProperties(range){var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=range.nativeRange[prop]}range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset}function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=range.startContainer!==startContainer||range.startOffset!=startOffset;var endMoved=range.endContainer!==endContainer||range.endOffset!=endOffset;var nativeRangeDifferent=!range.equals(range.nativeRange);if(startMoved||endMoved||nativeRangeDifferent){range.setEnd(endContainer,endOffset);range.setStart(startContainer,startOffset)}}var createBeforeAfterNodeSetter;WrappedRange=function(range){if(!range){throw module.createError("WrappedRange: Range must be specified")}this.nativeRange=range;updateRangeProperties(this)};DomRange.createPrototypeRange(WrappedRange,updateNativeRange);rangeProto=WrappedRange.prototype;rangeProto.selectNode=function(node){this.nativeRange.selectNode(node);updateRangeProperties(this)};rangeProto.cloneContents=function(){return this.nativeRange.cloneContents()};rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node);updateRangeProperties(this)};rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart);updateRangeProperties(this)};rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange())};rangeProto.refresh=function(){updateRangeProperties(this)};rangeProto.toString=function(){return this.nativeRange.toString()};var testTextNode=document.createTextNode("test");getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0);range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1);rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset);updateRangeProperties(this)};rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset);updateRangeProperties(this)};createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node);updateRangeProperties(this)}}}catch(ex){rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset)}catch(ex){this.nativeRange.setEnd(node,offset);this.nativeRange.setStart(node,offset)}updateRangeProperties(this)};rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset)}catch(ex){this.nativeRange.setStart(node,offset);this.nativeRange.setEnd(node,offset)}updateRangeProperties(this)};createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node)}catch(ex){this.nativeRange[oppositeName](node);this.nativeRange[name](node)}updateRangeProperties(this)}}}rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore");rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter");rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore");rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter");rangeProto.selectNodeContents=function(node){this.setStartAndEnd(node,0,dom.getNodeLength(node))};range.selectNodeContents(testTextNode);range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode);range2.setEnd(testTextNode,4);range2.setStart(testTextNode,2);if(range.compareBoundaryPoints(range.START_TO_END,range2)==-1&&range.compareBoundaryPoints(range.END_TO_START,range2)==1){rangeProto.compareBoundaryPoints=function(type,range){range=range.nativeRange||range;if(type==range.START_TO_END){type=range.END_TO_START}else if(type==range.END_TO_START){type=range.START_TO_END}return this.nativeRange.compareBoundaryPoints(type,range)}}else{rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range)}}var el=document.createElement("div");el.innerHTML="123";var textNode=el.firstChild;var body=getBody(document);body.appendChild(el);range.setStart(textNode,1);range.setEnd(textNode,2);range.deleteContents();if(textNode.data=="13"){rangeProto.deleteContents=function(){this.nativeRange.deleteContents();updateRangeProperties(this)};rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();updateRangeProperties(this);return frag}}else{}body.removeChild(el);body=null;if(util.isHostMethod(range,"createContextualFragment")){rangeProto.createContextualFragment=function(fragmentStr){return this.nativeRange.createContextualFragment(fragmentStr)}}getBody(document).removeChild(testTextNode);rangeProto.getName=function(){return"WrappedRange"};api.WrappedRange=WrappedRange;api.createNativeRange=function(doc){doc=getContentDocument(doc,module,"createNativeRange");return doc.createRange()}})()}if(api.features.implementsTextRange){var getTextRangeContainerElement=function(textRange){var parentEl=textRange.parentElement();var range=textRange.duplicate();range.collapse(true);var startEl=range.parentElement();range=textRange.duplicate();range.collapse(false);var endEl=range.parentElement();var startEndContainer=startEl==endEl?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer)};var textRangeIsCollapsed=function(textRange){return textRange.compareEndPoints("StartToEnd",textRange)==0};var getTextRangeBoundaryPosition=function(textRange,wholeRangeContainerElement,isStart,isCollapsed,startInfo){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(!dom.isOrIsAncestorOf(wholeRangeContainerElement,containerElement)){containerElement=wholeRangeContainerElement}if(!containerElement.canHaveHTML){var pos=new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement));return{boundaryPosition:pos,nodeInfo:{nodeIndex:pos.offset,containerElement:pos.node}}}var workingNode=dom.getDocument(containerElement).createElement("span");if(workingNode.parentNode){workingNode.parentNode.removeChild(workingNode)}var comparison,workingComparisonType=isStart?"StartToStart":"StartToEnd";var previousNode,nextNode,boundaryPosition,boundaryNode;var start=startInfo&&startInfo.containerElement==containerElement?startInfo.nodeIndex:0;var childNodeCount=containerElement.childNodes.length;var end=childNodeCount;var nodeIndex=end;while(true){if(nodeIndex==childNodeCount){containerElement.appendChild(workingNode)}else{containerElement.insertBefore(workingNode,containerElement.childNodes[nodeIndex])}workingRange.moveToElementText(workingNode);comparison=workingRange.compareEndPoints(workingComparisonType,textRange);if(comparison==0||start==end){break}else if(comparison==-1){if(end==start+1){break}else{start=nodeIndex}}else{end=end==start+1?start:nodeIndex}nodeIndex=Math.floor((start+end)/2);containerElement.removeChild(workingNode)}boundaryNode=workingNode.nextSibling;if(comparison==-1&&boundaryNode&&isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate();var rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;offset=tempRange.moveStart("character",rangeLength);while((comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1){offset++;tempRange.moveStart("character",1)}}else{offset=workingRange.text.length}boundaryPosition=new DomPosition(boundaryNode,offset)}else{previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling;nextNode=(isCollapsed||isStart)&&workingNode.nextSibling;if(nextNode&&isCharacterDataNode(nextNode)){boundaryPosition=new DomPosition(nextNode,0)}else if(previousNode&&isCharacterDataNode(previousNode)){boundaryPosition=new DomPosition(previousNode,previousNode.data.length)}else{boundaryPosition=new DomPosition(containerElement,dom.getNodeIndex(workingNode))}}workingNode.parentNode.removeChild(workingNode);return{boundaryPosition:boundaryPosition,nodeInfo:{nodeIndex:nodeIndex,containerElement:containerElement}}};var createBoundaryTextRange=function(boundaryPosition,isStart){var boundaryNode,boundaryParent,boundaryOffset=boundaryPosition.offset;var doc=dom.getDocument(boundaryPosition.node);var workingNode,childNodes,workingRange=getBody(doc).createTextRange();var nodeIsDataNode=isCharacterDataNode(boundaryPosition.node);if(nodeIsDataNode){boundaryNode=boundaryPosition.node;boundaryParent=boundaryNode.parentNode}else{childNodes=boundaryPosition.node.childNodes;boundaryNode=boundaryOffset<childNodes.length?childNodes[boundaryOffset]:null;boundaryParent=boundaryPosition.node}workingNode=doc.createElement("span");workingNode.innerHTML="&#feff;";if(boundaryNode){boundaryParent.insertBefore(workingNode,boundaryNode)}else{boundaryParent.appendChild(workingNode)}workingRange.moveToElementText(workingNode);workingRange.collapse(!isStart);boundaryParent.removeChild(workingNode);if(nodeIsDataNode){workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset)}return workingRange};WrappedTextRange=function(textRange){this.textRange=textRange;this.refresh()};WrappedTextRange.prototype=new DomRange(document);WrappedTextRange.prototype.refresh=function(){var start,end,startBoundary;var rangeContainerElement=getTextRangeContainerElement(this.textRange);if(textRangeIsCollapsed(this.textRange)){end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,true).boundaryPosition}else{startBoundary=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,false);start=startBoundary.boundaryPosition;end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,false,false,startBoundary.nodeInfo).boundaryPosition}this.setStart(start.node,start.offset);this.setEnd(end.node,end.offset)};WrappedTextRange.prototype.getName=function(){return"WrappedTextRange"};DomRange.copyComparisonConstants(WrappedTextRange);var rangeToTextRange=function(range){if(range.collapsed){return createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true)}else{var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);var endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),false);var textRange=getBody(DomRange.getRangeDocument(range)).createTextRange();textRange.setEndPoint("StartToStart",startRange);textRange.setEndPoint("EndToEnd",endRange);return textRange}};WrappedTextRange.rangeToTextRange=rangeToTextRange;WrappedTextRange.prototype.toTextRange=function(){return rangeToTextRange(this)};api.WrappedTextRange=WrappedTextRange;if(!api.features.implementsDomRange||api.config.preferTextRange){var globalObj=function(){return this}();if(typeof globalObj.Range=="undefined"){globalObj.Range=WrappedTextRange}api.createNativeRange=function(doc){doc=getContentDocument(doc,module,"createNativeRange");return getBody(doc).createTextRange()};api.WrappedRange=WrappedTextRange}}api.createRange=function(doc){doc=getContentDocument(doc,module,"createRange");return new api.WrappedRange(api.createNativeRange(doc))};api.createRangyRange=function(doc){doc=getContentDocument(doc,module,"createRangyRange");return new DomRange(doc)};api.createIframeRange=function(iframeEl){module.deprecationNotice("createIframeRange()","createRange(iframeEl)");return api.createRange(iframeEl)};api.createIframeRangyRange=function(iframeEl){module.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)");return api.createRangyRange(iframeEl)};api.addShimListener(function(win){var doc=win.document;if(typeof doc.createRange=="undefined"){doc.createRange=function(){return api.createRange(doc)}}doc=win=null})});api.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(api,module){api.config.checkSelectionRanges=true;var BOOLEAN="boolean";var NUMBER="number";var dom=api.dom;var util=api.util;var isHostMethod=util.isHostMethod;var DomRange=api.DomRange;var WrappedRange=api.WrappedRange;var DOMException=api.DOMException;var DomPosition=dom.DomPosition;var getNativeSelection;var selectionIsCollapsed;var features=api.features;var CONTROL="Control";var getDocument=dom.getDocument;var getBody=dom.getBody;var rangesEqual=DomRange.rangesEqual;function isDirectionBackward(dir){return typeof dir=="string"?/^backward(s)?$/i.test(dir):!!dir}function getWindow(win,methodName){if(!win){return window}else if(dom.isWindow(win)){return win}else if(win instanceof WrappedSelection){return win.win}else{var doc=dom.getContentDocument(win,module,methodName);return dom.getWindow(doc)}}function getWinSelection(winParam){return getWindow(winParam,"getWinSelection").getSelection()}function getDocSelection(winParam){return getWindow(winParam,"getDocSelection").document.selection}function winSelectionIsBackward(sel){var backward=false;if(sel.anchorNode){backward=dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)==1}return backward}var implementsWinGetSelection=isHostMethod(window,"getSelection"),implementsDocSelection=util.isHostObject(document,"selection");features.implementsWinGetSelection=implementsWinGetSelection;features.implementsDocSelection=implementsDocSelection;var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);if(useDocumentSelection){getNativeSelection=getDocSelection;api.isSelectionValid=function(winParam){var doc=getWindow(winParam,"isSelectionValid").document,nativeSel=doc.selection;return nativeSel.type!="None"||getDocument(nativeSel.createRange().parentElement())==doc}}else if(implementsWinGetSelection){getNativeSelection=getWinSelection;api.isSelectionValid=function(){return true}}else{module.fail("Neither document.selection or window.getSelection() detected.")}api.getNativeSelection=getNativeSelection;var testSelection=getNativeSelection();var testRange=api.createNativeRange(document);var body=getBody(document);var selectionHasAnchorAndFocus=util.areHostProperties(testSelection,["anchorNode","focusNode","anchorOffset","focusOffset"]);features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=isHostMethod(testSelection,"extend");features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=typeof testSelection.rangeCount==NUMBER;features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=false;var collapsedNonEditableSelectionsSupported=true;var addRangeBackwardToNative=selectionHasExtend?function(nativeSelection,range){var doc=DomRange.getRangeDocument(range);var endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset);nativeSelection.addRange(getNativeRange(endRange));nativeSelection.extend(range.startContainer,range.startOffset)}:null;if(util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount==NUMBER&&features.implementsDomRange){(function(){var sel=window.getSelection();if(sel){var originalSelectionRangeCount=sel.rangeCount;var selectionHasMultipleRanges=originalSelectionRangeCount>1;var originalSelectionRanges=[];var originalSelectionBackward=winSelectionIsBackward(sel);for(var i=0;i<originalSelectionRangeCount;++i){originalSelectionRanges[i]=sel.getRangeAt(i)}var body=getBody(document);var testEl=body.appendChild(document.createElement("div"));testEl.contentEditable="false";var textNode=testEl.appendChild(document.createTextNode(""));var r1=document.createRange();r1.setStart(textNode,1);r1.collapse(true);sel.addRange(r1);collapsedNonEditableSelectionsSupported=sel.rangeCount==1;sel.removeAllRanges();if(!selectionHasMultipleRanges){var chromeMatch=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(chromeMatch&&parseInt(chromeMatch[1])>=36){selectionSupportsMultipleRanges=false}else{var r2=r1.cloneRange();r1.setStart(textNode,0);r2.setEnd(textNode,3);r2.setStart(textNode,2);sel.addRange(r1);sel.addRange(r2);selectionSupportsMultipleRanges=sel.rangeCount==2}}body.removeChild(testEl);sel.removeAllRanges();for(i=0;i<originalSelectionRangeCount;++i){if(i==0&&originalSelectionBackward){if(addRangeBackwardToNative){addRangeBackwardToNative(sel,originalSelectionRanges[i])}else{api.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");sel.addRange(originalSelectionRanges[i])}}else{sel.addRange(originalSelectionRanges[i])}}}})()}features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges;features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var implementsControlRange=false,testControlRange;if(body&&isHostMethod(body,"createControlRange")){testControlRange=body.createControlRange();if(util.areHostProperties(testControlRange,["item","add"])){implementsControlRange=true}}features.implementsControlRange=implementsControlRange;if(selectionHasAnchorAndFocus){selectionIsCollapsed=function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset}}else{selectionIsCollapsed=function(sel){return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:false}}function updateAnchorAndFocusFromRange(sel,range,backward){var anchorPrefix=backward?"end":"start",focusPrefix=backward?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"];sel.anchorOffset=range[anchorPrefix+"Offset"];sel.focusNode=range[focusPrefix+"Container"];sel.focusOffset=range[focusPrefix+"Offset"]}function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode;sel.anchorOffset=nativeSel.anchorOffset;sel.focusNode=nativeSel.focusNode;sel.focusOffset=nativeSel.focusOffset}function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null;sel.anchorOffset=sel.focusOffset=0;sel.rangeCount=0;sel.isCollapsed=true;sel._ranges.length=0}function getNativeRange(range){var nativeRange;if(range instanceof DomRange){nativeRange=api.createNativeRange(range.getDocument());nativeRange.setEnd(range.endContainer,range.endOffset);nativeRange.setStart(range.startContainer,range.startOffset)}else if(range instanceof WrappedRange){nativeRange=range.nativeRange}else if(features.implementsDomRange&&range instanceof dom.getWindow(range.startContainer).Range){nativeRange=range}return nativeRange}function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||rangeNodes[0].nodeType!=1){return false}for(var i=1,len=rangeNodes.length;i<len;++i){if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i])){return false}}return true}function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes)){throw module.createError("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element")}return nodes[0]}function isTextRange(range){return!!range&&typeof range.text!="undefined"}function updateFromTextRange(sel,range){var wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange];updateAnchorAndFocusFromRange(sel,wrappedRange,false);sel.rangeCount=1;sel.isCollapsed=wrappedRange.collapsed}function updateControlSelection(sel){sel._ranges.length=0;if(sel.docSelection.type=="None"){updateEmptySelection(sel)}else{var controlRange=sel.docSelection.createRange();if(isTextRange(controlRange)){updateFromTextRange(sel,controlRange)}else{sel.rangeCount=controlRange.length;var range,doc=getDocument(controlRange.item(0));

for(var i=0;i<sel.rangeCount;++i){range=api.createRange(doc);range.selectNode(controlRange.item(i));sel._ranges.push(range)}sel.isCollapsed=sel.rangeCount==1&&sel._ranges[0].collapsed;updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],false)}}}function addRangeToControlSelection(sel,range){var controlRange=sel.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=getDocument(controlRange.item(0));var newControlRange=getBody(doc).createControlRange();for(var i=0,len=controlRange.length;i<len;++i){newControlRange.add(controlRange.item(i))}try{newControlRange.add(rangeElement)}catch(ex){throw module.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}newControlRange.select();updateControlSelection(sel)}var getSelectionRangeAt;if(isHostMethod(testSelection,"getRangeAt")){getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index)}catch(ex){return null}}}else if(selectionHasAnchorAndFocus){getSelectionRangeAt=function(sel){var doc=getDocument(sel.anchorNode);var range=api.createRange(doc);range.setStartAndEnd(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset);if(range.collapsed!==this.isCollapsed){range.setStartAndEnd(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset)}return range}}function WrappedSelection(selection,docSelection,win){this.nativeSelection=selection;this.docSelection=docSelection;this._ranges=[];this.win=win;this.refresh()}WrappedSelection.prototype=api.selectionPrototype;function deleteProperties(sel){sel.win=sel.anchorNode=sel.focusNode=sel._ranges=null;sel.rangeCount=sel.anchorOffset=sel.focusOffset=0;sel.detached=true}var cachedRangySelections=[];function actOnCachedSelection(win,action){var i=cachedRangySelections.length,cached,sel;while(i--){cached=cachedRangySelections[i];sel=cached.selection;if(action=="deleteAll"){deleteProperties(sel)}else if(cached.win==win){if(action=="delete"){cachedRangySelections.splice(i,1);return true}else{return sel}}}if(action=="deleteAll"){cachedRangySelections.length=0}return null}var getSelection=function(win){if(win&&win instanceof WrappedSelection){win.refresh();return win}win=getWindow(win,"getNativeSelection");var sel=actOnCachedSelection(win);var nativeSel=getNativeSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;if(sel){sel.nativeSelection=nativeSel;sel.docSelection=docSel;sel.refresh()}else{sel=new WrappedSelection(nativeSel,docSel,win);cachedRangySelections.push({win:win,selection:sel})}return sel};api.getSelection=getSelection;api.getIframeSelection=function(iframeEl){module.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return api.getSelection(dom.getIframeWindow(iframeEl))};var selProto=WrappedSelection.prototype;function createControlSelection(sel,ranges){var doc=getDocument(ranges[0].startContainer);var controlRange=getBody(doc).createControlRange();for(var i=0,el,len=ranges.length;i<len;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el)}catch(ex){throw module.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}controlRange.select();updateControlSelection(sel)}if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges();updateEmptySelection(this)};var addRangeBackward=function(sel,range){addRangeBackwardToNative(sel.nativeSelection,range);sel.refresh()};if(selectionHasRangeCount){selProto.addRange=function(range,direction){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){addRangeToControlSelection(this,range)}else{if(isDirectionBackward(direction)&&selectionHasExtend){addRangeBackward(this,range)}else{var previousRangeCount;if(selectionSupportsMultipleRanges){previousRangeCount=this.rangeCount}else{this.removeAllRanges();previousRangeCount=0}var clonedNativeRange=getNativeRange(range).cloneRange();try{this.nativeSelection.addRange(clonedNativeRange)}catch(ex){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);if(nativeRange&&!rangesEqual(nativeRange,range)){range=new WrappedRange(nativeRange)}}this._ranges[this.rangeCount-1]=range;updateAnchorAndFocusFromRange(this,range,selectionIsBackward(this.nativeSelection));this.isCollapsed=selectionIsCollapsed(this)}else{this.refresh()}}}}}else{selProto.addRange=function(range,direction){if(isDirectionBackward(direction)&&selectionHasExtend){addRangeBackward(this,range)}else{this.nativeSelection.addRange(getNativeRange(range));this.refresh()}}}selProto.setRanges=function(ranges){if(implementsControlRange&&implementsDocSelection&&ranges.length>1){createControlSelection(this,ranges)}else{this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){this.addRange(ranges[i])}}}}else if(isHostMethod(testSelection,"empty")&&isHostMethod(testRange,"select")&&implementsControlRange&&useDocumentSelection){selProto.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var doc;if(this.anchorNode){doc=getDocument(this.anchorNode)}else if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();if(controlRange.length){doc=getDocument(controlRange.item(0))}}if(doc){var textRange=getBody(doc).createTextRange();textRange.select();this.docSelection.empty()}}}catch(ex){}updateEmptySelection(this)};selProto.addRange=function(range){if(this.docSelection.type==CONTROL){addRangeToControlSelection(this,range)}else{api.WrappedTextRange.rangeToTextRange(range).select();this._ranges[0]=range;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;updateAnchorAndFocusFromRange(this,range,false)}};selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;if(rangeCount>1){createControlSelection(this,ranges)}else if(rangeCount){this.addRange(ranges[0])}}}else{module.fail("No means of selecting a Range or TextRange was found");return false}selProto.getRangeAt=function(index){if(index<0||index>=this.rangeCount){throw new DOMException("INDEX_SIZE_ERR")}else{return this._ranges[index].cloneRange()}};var refreshSelection;if(useDocumentSelection){refreshSelection=function(sel){var range;if(api.isSelectionValid(sel.win)){range=sel.docSelection.createRange()}else{range=getBody(sel.win.document).createTextRange();range.collapse(true)}if(sel.docSelection.type==CONTROL){updateControlSelection(sel)}else if(isTextRange(range)){updateFromTextRange(sel,range)}else{updateEmptySelection(sel)}}}else if(isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount==NUMBER){refreshSelection=function(sel){if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL){updateControlSelection(sel)}else{sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount;if(sel.rangeCount){for(var i=0,len=sel.rangeCount;i<len;++i){sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i))}updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackward(sel.nativeSelection));sel.isCollapsed=selectionIsCollapsed(sel)}else{updateEmptySelection(sel)}}}}else if(selectionHasAnchorAndFocus&&typeof testSelection.isCollapsed==BOOLEAN&&typeof testRange.collapsed==BOOLEAN&&features.implementsDomRange){refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;if(nativeSel.anchorNode){range=getSelectionRangeAt(nativeSel,0);sel._ranges=[range];sel.rangeCount=1;updateAnchorAndFocusFromNativeSelection(sel);sel.isCollapsed=selectionIsCollapsed(sel)}else{updateEmptySelection(sel)}}}else{module.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null;var oldAnchorNode=this.anchorNode,oldAnchorOffset=this.anchorOffset;refreshSelection(this);if(checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length){return true}if(this.anchorNode!=oldAnchorNode||this.anchorOffset!=oldAnchorOffset){return true}while(i--){if(!rangesEqual(oldRanges[i],this._ranges[i])){return true}}return false}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges();sel.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){if(!rangesEqual(range,ranges[i])){sel.addRange(ranges[i])}}if(!sel.rangeCount){updateEmptySelection(sel)}};if(implementsControlRange&&implementsDocSelection){selProto.removeRange=function(range){if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=getDocument(controlRange.item(0));var newControlRange=getBody(doc).createControlRange();var el,removed=false;for(var i=0,len=controlRange.length;i<len;++i){el=controlRange.item(i);if(el!==rangeElement||removed){newControlRange.add(controlRange.item(i))}else{removed=true}}newControlRange.select();updateControlSelection(this)}else{removeRangeManually(this,range)}}}else{selProto.removeRange=function(range){removeRangeManually(this,range)}}var selectionIsBackward;if(!useDocumentSelection&&selectionHasAnchorAndFocus&&features.implementsDomRange){selectionIsBackward=winSelectionIsBackward;selProto.isBackward=function(){return selectionIsBackward(this)}}else{selectionIsBackward=selProto.isBackward=function(){return false}}selProto.isBackwards=selProto.isBackward;selProto.toString=function(){var rangeTexts=[];for(var i=0,len=this.rangeCount;i<len;++i){rangeTexts[i]=""+this._ranges[i]}return rangeTexts.join("")};function assertNodeInSameDocument(sel,node){if(sel.win.document!=getDocument(node)){throw new DOMException("WRONG_DOCUMENT_ERR")}}selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(node);range.collapseToPoint(node,offset);this.setSingleRange(range);this.isCollapsed=true};selProto.collapseToStart=function(){if(this.rangeCount){var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset)}else{throw new DOMException("INVALID_STATE_ERR")}};selProto.collapseToEnd=function(){if(this.rangeCount){var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset)}else{throw new DOMException("INVALID_STATE_ERR")}};selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(node);range.selectNodeContents(node);this.setSingleRange(range)};selProto.deleteFromDocument=function(){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var element;while(controlRange.length){element=controlRange.item(0);controlRange.remove(element);element.parentNode.removeChild(element)}this.refresh()}else if(this.rangeCount){var ranges=this.getAllRanges();if(ranges.length){this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){ranges[i].deleteContents()}this.addRange(ranges[len-1])}}};selProto.eachRange=function(func,returnValue){for(var i=0,len=this._ranges.length;i<len;++i){if(func(this.getRangeAt(i))){return returnValue}}};selProto.getAllRanges=function(){var ranges=[];this.eachRange(function(range){ranges.push(range)});return ranges};selProto.setSingleRange=function(range,direction){this.removeAllRanges();this.addRange(range,direction)};selProto.callMethodOnEachRange=function(methodName,params){var results=[];this.eachRange(function(range){results.push(range[methodName].apply(range,params))});return results};function createStartOrEndSetter(isStart){return function(node,offset){var range;if(this.rangeCount){range=this.getRangeAt(0);range["set"+(isStart?"Start":"End")](node,offset)}else{range=api.createRange(this.win.document);range.setStartAndEnd(node,offset)}this.setSingleRange(range,this.isBackward())}}selProto.setStart=createStartOrEndSetter(true);selProto.setEnd=createStartOrEndSetter(false);api.rangePrototype.select=function(direction){getSelection(this.getDocument()).setSingleRange(this,direction)};selProto.changeEachRange=function(func){var ranges=[];var backward=this.isBackward();this.eachRange(function(range){func(range);ranges.push(range)});this.removeAllRanges();if(backward&&ranges.length==1){this.addRange(ranges[0],"backward")}else{this.setRanges(ranges)}};selProto.containsNode=function(node,allowPartial){return this.eachRange(function(range){return range.containsNode(node,allowPartial)},true)||false};selProto.getBookmark=function(containerNode){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[containerNode])}};selProto.moveToBookmark=function(bookmark){var selRanges=[];for(var i=0,rangeBookmark,range;rangeBookmark=bookmark.rangeBookmarks[i++];){range=api.createRange(this.win);range.moveToBookmark(rangeBookmark);selRanges.push(range)}if(bookmark.backward){this.setSingleRange(selRanges[0],"backward")}else{this.setRanges(selRanges)}};selProto.toHtml=function(){var rangeHtmls=[];this.eachRange(function(range){rangeHtmls.push(DomRange.toHtml(range))});return rangeHtmls.join("")};if(features.implementsTextRange){selProto.getNativeTextRange=function(){var sel,textRange;if(sel=this.docSelection){var range=sel.createRange();if(isTextRange(range)){return range}else{throw module.createError("getNativeTextRange: selection is a control selection")}}else if(this.rangeCount>0){return api.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}else{throw module.createError("getNativeTextRange: selection contains no range")}}}function inspect(sel){var rangeInspects=[];var anchor=new DomPosition(sel.anchorNode,sel.anchorOffset);var focus=new DomPosition(sel.focusNode,sel.focusOffset);var name=typeof sel.getName=="function"?sel.getName():"Selection";if(typeof sel.rangeCount!="undefined"){for(var i=0,len=sel.rangeCount;i<len;++i){rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i))}}return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]"}selProto.getName=function(){return"WrappedSelection"};selProto.inspect=function(){return inspect(this)};selProto.detach=function(){actOnCachedSelection(this.win,"delete");deleteProperties(this)};WrappedSelection.detachAll=function(){actOnCachedSelection(null,"deleteAll")};WrappedSelection.inspect=inspect;WrappedSelection.isDirectionBackward=isDirectionBackward;api.Selection=WrappedSelection;api.selectionPrototype=selProto;api.addShimListener(function(win){if(typeof win.getSelection=="undefined"){win.getSelection=function(){return getSelection(win)}}win=null})});var docReady=false;var loadHandler=function(e){if(!docReady){docReady=true;if(!api.initialized&&api.config.autoInitialize){init()}}};if(isBrowser){if(/^(?:complete|interactive)$/.test(document.readyState)){loadHandler()}else{if(isHostMethod(document,"addEventListener")){document.addEventListener("DOMContentLoaded",loadHandler,false)}addListener(window,"load",loadHandler)}}return api},function(f){return f("return this;")()}(Function))}});require.register({"rangy-textrange":function(exports,require,module){(function(factory,global){if(typeof define=="function"&&define.amd){define(["./rangy-core"],factory)}else if(typeof module!="undefined"&&typeof exports=="object"){module.exports=factory(require("rangy"))}else{factory(global.rangy)}})(function(rangy){rangy.createModule("TextRange",["WrappedSelection"],function(api,module){var UNDEF="undefined";var CHARACTER="character",WORD="word";var dom=api.dom,util=api.util;var extend=util.extend;var createOptions=util.createOptions;var getBody=dom.getBody;var spacesRegex=/^[ \t\f\r\n]+$/;var spacesMinusLineBreaksRegex=/^[ \t\f\r]+$/;var allWhiteSpaceRegex=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/;var nonLineBreakWhiteSpaceRegex=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/;var lineBreakRegex=/^[\n-\r\u0085\u2028\u2029]$/;var defaultLanguage="en";var isDirectionBackward=api.Selection.isDirectionBackward;var trailingSpaceInBlockCollapses=false;var trailingSpaceBeforeBrCollapses=false;var trailingSpaceBeforeBlockCollapses=false;var trailingSpaceBeforeLineBreakInPreLineCollapses=true;(function(){var el=document.createElement("div");el.contentEditable="true";el.innerHTML="<p>1 </p><p></p>";var body=getBody(document);var p=el.firstChild;var sel=api.getSelection();body.appendChild(el);sel.collapse(p.lastChild,2);sel.setStart(p.firstChild,0);trailingSpaceInBlockCollapses=(""+sel).length==1;el.innerHTML="1 <br>";sel.collapse(el,2);sel.setStart(el.firstChild,0);trailingSpaceBeforeBrCollapses=(""+sel).length==1;el.innerHTML="1 <p>1</p>";sel.collapse(el,2);sel.setStart(el.firstChild,0);trailingSpaceBeforeBlockCollapses=(""+sel).length==1;body.removeChild(el);sel.removeAllRanges()})();function defaultTokenizer(chars,wordOptions){var word=chars.join(""),result,tokens=[];function createTokenFromRange(start,end,isWord){var tokenChars=chars.slice(start,end);var token={isWord:isWord,chars:tokenChars,toString:function(){return tokenChars.join("")}};for(var i=0,len=tokenChars.length;i<len;++i){tokenChars[i].token=token}tokens.push(token)}var lastWordEnd=0,wordStart,wordEnd;while(result=wordOptions.wordRegex.exec(word)){wordStart=result.index;wordEnd=wordStart+result[0].length;if(wordStart>lastWordEnd){createTokenFromRange(lastWordEnd,wordStart,false)}if(wordOptions.includeTrailingSpace){while(nonLineBreakWhiteSpaceRegex.test(chars[wordEnd])){++wordEnd}}createTokenFromRange(wordStart,wordEnd,true);lastWordEnd=wordEnd}if(lastWordEnd<chars.length){createTokenFromRange(lastWordEnd,chars.length,false)}return tokens}var defaultCharacterOptions={includeBlockContentTrailingSpace:true,includeSpaceBeforeBr:true,includeSpaceBeforeBlock:true,includePreLineTrailingSpace:true,ignoreCharacters:""};function normalizeIgnoredCharacters(ignoredCharacters){var ignoredChars=ignoredCharacters||"";var ignoredCharsArray=typeof ignoredChars=="string"?ignoredChars.split(""):ignoredChars;ignoredCharsArray.sort(function(char1,char2){return char1.charCodeAt(0)-char2.charCodeAt(0)});return ignoredCharsArray.join("").replace(/(.)\1+/g,"$1")}var defaultCaretCharacterOptions={includeBlockContentTrailingSpace:!trailingSpaceBeforeLineBreakInPreLineCollapses,includeSpaceBeforeBr:!trailingSpaceBeforeBrCollapses,includeSpaceBeforeBlock:!trailingSpaceBeforeBlockCollapses,includePreLineTrailingSpace:true};var defaultWordOptions={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:false,tokenizer:defaultTokenizer}};var defaultFindOptions={caseSensitive:false,withinRange:null,wholeWordsOnly:false,wrap:false,direction:"forward",wordOptions:null,characterOptions:null};var defaultMoveOptions={wordOptions:null,characterOptions:null};var defaultExpandOptions={wordOptions:null,characterOptions:null,trim:false,trimStart:true,trimEnd:true};var defaultWordIteratorOptions={wordOptions:null,characterOptions:null,direction:"forward"};function createWordOptions(options){var lang,defaults;if(!options){return defaultWordOptions[defaultLanguage]}else{lang=options.language||defaultLanguage;defaults={};extend(defaults,defaultWordOptions[lang]||defaultWordOptions[defaultLanguage]);extend(defaults,options);return defaults}}function createCharacterOptions(options){return createOptions(options,defaultCharacterOptions)}function createCaretCharacterOptions(options){return createOptions(options,defaultCaretCharacterOptions)}function createFindOptions(optionsParam){var options=createOptions(optionsParam,defaultFindOptions);options.characterOptions=createCharacterOptions(options.wordOptions);return options}var getComputedStyleProperty=dom.getComputedStyleProperty;var tableCssDisplayBlock;(function(){var table=document.createElement("table");var body=getBody(document);body.appendChild(table);tableCssDisplayBlock=getComputedStyleProperty(table,"display")=="block";body.removeChild(table)})();api.features.tableCssDisplayBlock=tableCssDisplayBlock;var defaultDisplayValueForTag={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};function getComputedDisplay(el,win){var display=getComputedStyleProperty(el,"display",win);var tagName=el.tagName.toLowerCase();return display=="block"&&tableCssDisplayBlock&&defaultDisplayValueForTag.hasOwnProperty(tagName)?defaultDisplayValueForTag[tagName]:display}function isHidden(node){var ancestors=getAncestorsAndSelf(node);for(var i=0,len=ancestors.length;i<len;++i){if(ancestors[i].nodeType==1&&getComputedDisplay(ancestors[i])=="none"){return true}}return false}function isVisibilityHiddenTextNode(textNode){var el;return textNode.nodeType==3&&(el=textNode.parentNode)&&getComputedStyleProperty(el,"visibility")=="hidden"}function isBlockNode(node){return node&&(node.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(getComputedDisplay(node))||node.nodeType==9||node.nodeType==11)}function getLastDescendantOrSelf(node){var lastChild=node.lastChild;return lastChild?getLastDescendantOrSelf(lastChild):node}function containsPositions(node){return dom.isCharacterDataNode(node)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(node.nodeName)}function getAncestors(node){var ancestors=[];while(node.parentNode){ancestors.unshift(node.parentNode);node=node.parentNode}return ancestors}function getAncestorsAndSelf(node){return getAncestors(node).concat([node])}function nextNodeDescendants(node){while(node&&!node.nextSibling){node=node.parentNode}if(!node){return null}return node.nextSibling}function nextNode(node,excludeChildren){if(!excludeChildren&&node.hasChildNodes()){return node.firstChild}return nextNodeDescendants(node)}function previousNode(node){var previous=node.previousSibling;if(previous){node=previous;while(node.hasChildNodes()){node=node.lastChild}return node}var parent=node.parentNode;if(parent&&parent.nodeType==1){return parent}return null}function isWhitespaceNode(node){if(!node||node.nodeType!=3){return false}var text=node.data;if(text===""){return true}var parent=node.parentNode;if(!parent||parent.nodeType!=1){return false}var computedWhiteSpace=getComputedStyleProperty(node.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(text)&&/^(normal|nowrap)$/.test(computedWhiteSpace)||/^[\t\r ]+$/.test(text)&&computedWhiteSpace=="pre-line"}function isCollapsedWhitespaceNode(node){if(node.data===""){return true}if(!isWhitespaceNode(node)){return false}var ancestor=node.parentNode;if(!ancestor){return true}if(isHidden(node)){return true}return false}function isCollapsedNode(node){var type=node.nodeType;return type==7||type==8||isHidden(node)||/^(script|style)$/i.test(node.nodeName)||isVisibilityHiddenTextNode(node)||isCollapsedWhitespaceNode(node)}function isIgnoredNode(node,win){var type=node.nodeType;return type==7||type==8||type==1&&getComputedDisplay(node,win)=="none"}function Cache(){this.store={}}Cache.prototype={get:function(key){return this.store.hasOwnProperty(key)?this.store[key]:null},set:function(key,value){return this.store[key]=value}};var cachedCount=0,uncachedCount=0;function createCachingGetter(methodName,func,objProperty){return function(args){var cache=this.cache;if(cache.hasOwnProperty(methodName)){cachedCount++;return cache[methodName]}else{uncachedCount++;var value=func.call(this,objProperty?this[objProperty]:this,args);cache[methodName]=value;return value}}}function NodeWrapper(node,session){this.node=node;this.session=session;this.cache=new Cache;this.positions=new Cache}var nodeProto={getPosition:function(offset){var positions=this.positions;return positions.get(offset)||positions.set(offset,new Position(this,offset))},toString:function(){return"[NodeWrapper("+dom.inspectNode(this.node)+")]"}};NodeWrapper.prototype=nodeProto;var EMPTY="EMPTY",NON_SPACE="NON_SPACE",UNCOLLAPSIBLE_SPACE="UNCOLLAPSIBLE_SPACE",COLLAPSIBLE_SPACE="COLLAPSIBLE_SPACE",TRAILING_SPACE_BEFORE_BLOCK="TRAILING_SPACE_BEFORE_BLOCK",TRAILING_SPACE_IN_BLOCK="TRAILING_SPACE_IN_BLOCK",TRAILING_SPACE_BEFORE_BR="TRAILING_SPACE_BEFORE_BR",PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",TRAILING_LINE_BREAK_AFTER_BR="TRAILING_LINE_BREAK_AFTER_BR";extend(nodeProto,{isCharacterDataNode:createCachingGetter("isCharacterDataNode",dom.isCharacterDataNode,"node"),getNodeIndex:createCachingGetter("nodeIndex",dom.getNodeIndex,"node"),getLength:createCachingGetter("nodeLength",dom.getNodeLength,"node"),containsPositions:createCachingGetter("containsPositions",containsPositions,"node"),isWhitespace:createCachingGetter("isWhitespace",isWhitespaceNode,"node"),isCollapsedWhitespace:createCachingGetter("isCollapsedWhitespace",isCollapsedWhitespaceNode,"node"),getComputedDisplay:createCachingGetter("computedDisplay",getComputedDisplay,"node"),isCollapsed:createCachingGetter("collapsed",isCollapsedNode,"node"),isIgnored:createCachingGetter("ignored",isIgnoredNode,"node"),next:createCachingGetter("nextPos",nextNode,"node"),previous:createCachingGetter("previous",previousNode,"node"),getTextNodeInfo:createCachingGetter("textNodeInfo",function(textNode){var spaceRegex=null,collapseSpaces=false;var cssWhitespace=getComputedStyleProperty(textNode.parentNode,"whiteSpace");var preLine=cssWhitespace=="pre-line";if(preLine){spaceRegex=spacesMinusLineBreaksRegex;collapseSpaces=true}else if(cssWhitespace=="normal"||cssWhitespace=="nowrap"){spaceRegex=spacesRegex;collapseSpaces=true}return{node:textNode,text:textNode.data,spaceRegex:spaceRegex,collapseSpaces:collapseSpaces,preLine:preLine}},"node"),hasInnerText:createCachingGetter("hasInnerText",function(el,backward){var session=this.session;var posAfterEl=session.getPosition(el.parentNode,this.getNodeIndex()+1);var firstPosInEl=session.getPosition(el,0);var pos=backward?posAfterEl:firstPosInEl;var endPos=backward?firstPosInEl:posAfterEl;while(pos!==endPos){pos.prepopulateChar();if(pos.isDefinitelyNonEmpty()){return true}pos=backward?pos.previousVisible():pos.nextVisible()}return false},"node"),isRenderedBlock:createCachingGetter("isRenderedBlock",function(el){var brs=el.getElementsByTagName("br");for(var i=0,len=brs.length;i<len;++i){if(!isCollapsedNode(brs[i])){return true}}return this.hasInnerText()},"node"),getTrailingSpace:createCachingGetter("trailingSpace",function(el){if(el.tagName.toLowerCase()=="br"){return""}else{switch(this.getComputedDisplay()){case"inline":var child=el.lastChild;while(child){if(!isIgnoredNode(child)){return child.nodeType==1?this.session.getNodeWrapper(child).getTrailingSpace():""}child=child.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(true)?"\n":""}}return""},"node"),getLeadingSpace:createCachingGetter("leadingSpace",function(el){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(false)?"\n":""}return""},"node")});function Position(nodeWrapper,offset){this.offset=offset;this.nodeWrapper=nodeWrapper;this.node=nodeWrapper.node;this.session=nodeWrapper.session;this.cache=new Cache}function inspectPosition(){return"[Position("+dom.inspectNode(this.node)+":"+this.offset+")]"}var positionProto={character:"",characterType:EMPTY,isBr:false,prepopulateChar:function(){var pos=this;if(!pos.prepopulatedChar){var node=pos.node,offset=pos.offset;var visibleChar="",charType=EMPTY;var finalizedChar=false;if(offset>0){if(node.nodeType==3){var text=node.data;var textChar=text.charAt(offset-1);var nodeInfo=pos.nodeWrapper.getTextNodeInfo();var spaceRegex=nodeInfo.spaceRegex;if(nodeInfo.collapseSpaces){if(spaceRegex.test(textChar)){if(offset>1&&spaceRegex.test(text.charAt(offset-2))){}else if(nodeInfo.preLine&&text.charAt(offset)==="\n"){visibleChar=" ";charType=PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK}else{visibleChar=" ";charType=COLLAPSIBLE_SPACE}}else{visibleChar=textChar;charType=NON_SPACE;finalizedChar=true}}else{visibleChar=textChar;charType=UNCOLLAPSIBLE_SPACE;finalizedChar=true}}else{var nodePassed=node.childNodes[offset-1];if(nodePassed&&nodePassed.nodeType==1&&!isCollapsedNode(nodePassed)){if(nodePassed.tagName.toLowerCase()=="br"){visibleChar="\n";pos.isBr=true;charType=COLLAPSIBLE_SPACE;finalizedChar=false}else{pos.checkForTrailingSpace=true}}if(!visibleChar){var nextNode=node.childNodes[offset];if(nextNode&&nextNode.nodeType==1&&!isCollapsedNode(nextNode)){pos.checkForLeadingSpace=true}}}}pos.prepopulatedChar=true;pos.character=visibleChar;pos.characterType=charType;pos.isCharInvariant=finalizedChar}},isDefinitelyNonEmpty:function(){var charType=this.characterType;return charType==NON_SPACE||charType==UNCOLLAPSIBLE_SPACE},resolveLeadingAndTrailingSpaces:function(){if(!this.prepopulatedChar){this.prepopulateChar()}if(this.checkForTrailingSpace){var trailingSpace=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();if(trailingSpace){this.isTrailingSpace=true;this.character=trailingSpace;this.characterType=COLLAPSIBLE_SPACE}this.checkForTrailingSpace=false}if(this.checkForLeadingSpace){var leadingSpace=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();if(leadingSpace){this.isLeadingSpace=true;this.character=leadingSpace;this.characterType=COLLAPSIBLE_SPACE}this.checkForLeadingSpace=false}},getPrecedingUncollapsedPosition:function(characterOptions){var pos=this,character;while(pos=pos.previousVisible()){character=pos.getCharacter(characterOptions);if(character!==""){return pos}}return null},getCharacter:function(characterOptions){this.resolveLeadingAndTrailingSpaces();var thisChar=this.character,returnChar;var ignoredChars=normalizeIgnoredCharacters(characterOptions.ignoreCharacters);var isIgnoredCharacter=thisChar!==""&&ignoredChars.indexOf(thisChar)>-1;if(this.isCharInvariant){returnChar=isIgnoredCharacter?"":thisChar;return returnChar}var cacheKey=["character",characterOptions.includeSpaceBeforeBr,characterOptions.includeBlockContentTrailingSpace,characterOptions.includePreLineTrailingSpace,ignoredChars].join("_");var cachedChar=this.cache.get(cacheKey);if(cachedChar!==null){return cachedChar}var character="";var collapsible=this.characterType==COLLAPSIBLE_SPACE;var nextPos,previousPos;var gotPreviousPos=false;var pos=this;function getPreviousPos(){if(!gotPreviousPos){previousPos=pos.getPrecedingUncollapsedPosition(characterOptions);gotPreviousPos=true}return previousPos}if(collapsible){if(thisChar==" "&&(!getPreviousPos()||previousPos.isTrailingSpace||previousPos.character=="\n")){}else if(thisChar=="\n"&&this.isLeadingSpace){if(getPreviousPos()&&previousPos.character!="\n"){character="\n"}else{}}else{nextPos=this.nextUncollapsed();if(nextPos){if(nextPos.isBr){this.type=TRAILING_SPACE_BEFORE_BR}else if(nextPos.isTrailingSpace&&nextPos.character=="\n"){this.type=TRAILING_SPACE_IN_BLOCK}else if(nextPos.isLeadingSpace&&nextPos.character=="\n"){this.type=TRAILING_SPACE_BEFORE_BLOCK}if(nextPos.character=="\n"){if(this.type==TRAILING_SPACE_BEFORE_BR&&!characterOptions.includeSpaceBeforeBr){}else if(this.type==TRAILING_SPACE_BEFORE_BLOCK&&!characterOptions.includeSpaceBeforeBlock){}else if(this.type==TRAILING_SPACE_IN_BLOCK&&nextPos.isTrailingSpace&&!characterOptions.includeBlockContentTrailingSpace){}else if(this.type==PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK&&nextPos.type==NON_SPACE&&!characterOptions.includePreLineTrailingSpace){}else if(thisChar=="\n"){if(nextPos.isTrailingSpace){if(this.isTrailingSpace){}else if(this.isBr){nextPos.type=TRAILING_LINE_BREAK_AFTER_BR;if(getPreviousPos()&&previousPos.isLeadingSpace&&previousPos.character=="\n"){nextPos.character=""}else{}}}else{character="\n";

}}else if(thisChar==" "){character=" "}else{}}else{character=thisChar}}else{}}}else if(thisChar=="\n"&&(!(nextPos=this.nextUncollapsed())||nextPos.isTrailingSpace)){}if(ignoredChars.indexOf(character)>-1){character=""}this.cache.set(cacheKey,character);return character},equals:function(pos){return!!pos&&this.node===pos.node&&this.offset===pos.offset},inspect:inspectPosition,toString:function(){return this.character}};Position.prototype=positionProto;extend(positionProto,{next:createCachingGetter("nextPos",function(pos){var nodeWrapper=pos.nodeWrapper,node=pos.node,offset=pos.offset,session=nodeWrapper.session;if(!node){return null}var nextNode,nextOffset,child;if(offset==nodeWrapper.getLength()){nextNode=node.parentNode;nextOffset=nextNode?nodeWrapper.getNodeIndex()+1:0}else{if(nodeWrapper.isCharacterDataNode()){nextNode=node;nextOffset=offset+1}else{child=node.childNodes[offset];if(session.getNodeWrapper(child).containsPositions()){nextNode=child;nextOffset=0}else{nextNode=node;nextOffset=offset+1}}}return nextNode?session.getPosition(nextNode,nextOffset):null}),previous:createCachingGetter("previous",function(pos){var nodeWrapper=pos.nodeWrapper,node=pos.node,offset=pos.offset,session=nodeWrapper.session;var previousNode,previousOffset,child;if(offset==0){previousNode=node.parentNode;previousOffset=previousNode?nodeWrapper.getNodeIndex():0}else{if(nodeWrapper.isCharacterDataNode()){previousNode=node;previousOffset=offset-1}else{child=node.childNodes[offset-1];if(session.getNodeWrapper(child).containsPositions()){previousNode=child;previousOffset=dom.getNodeLength(child)}else{previousNode=node;previousOffset=offset-1}}}return previousNode?session.getPosition(previousNode,previousOffset):null}),nextVisible:createCachingGetter("nextVisible",function(pos){var next=pos.next();if(!next){return null}var nodeWrapper=next.nodeWrapper,node=next.node;var newPos=next;if(nodeWrapper.isCollapsed()){newPos=nodeWrapper.session.getPosition(node.parentNode,nodeWrapper.getNodeIndex()+1)}return newPos}),nextUncollapsed:createCachingGetter("nextUncollapsed",function(pos){var nextPos=pos;while(nextPos=nextPos.nextVisible()){nextPos.resolveLeadingAndTrailingSpaces();if(nextPos.character!==""){return nextPos}}return null}),previousVisible:createCachingGetter("previousVisible",function(pos){var previous=pos.previous();if(!previous){return null}var nodeWrapper=previous.nodeWrapper,node=previous.node;var newPos=previous;if(nodeWrapper.isCollapsed()){newPos=nodeWrapper.session.getPosition(node.parentNode,nodeWrapper.getNodeIndex())}return newPos})});var currentSession=null;var Session=function(){function createWrapperCache(nodeProperty){var cache=new Cache;return{get:function(node){var wrappersByProperty=cache.get(node[nodeProperty]);if(wrappersByProperty){for(var i=0,wrapper;wrapper=wrappersByProperty[i++];){if(wrapper.node===node){return wrapper}}}return null},set:function(nodeWrapper){var property=nodeWrapper.node[nodeProperty];var wrappersByProperty=cache.get(property)||cache.set(property,[]);wrappersByProperty.push(nodeWrapper)}}}var uniqueIDSupported=util.isHostProperty(document.documentElement,"uniqueID");function Session(){this.initCaches()}Session.prototype={initCaches:function(){this.elementCache=uniqueIDSupported?function(){var elementsCache=new Cache;return{get:function(el){return elementsCache.get(el.uniqueID)},set:function(elWrapper){elementsCache.set(elWrapper.node.uniqueID,elWrapper)}}}():createWrapperCache("tagName");this.textNodeCache=createWrapperCache("data");this.otherNodeCache=createWrapperCache("nodeName")},getNodeWrapper:function(node){var wrapperCache;switch(node.nodeType){case 1:wrapperCache=this.elementCache;break;case 3:wrapperCache=this.textNodeCache;break;default:wrapperCache=this.otherNodeCache;break}var wrapper=wrapperCache.get(node);if(!wrapper){wrapper=new NodeWrapper(node,this);wrapperCache.set(wrapper)}return wrapper},getPosition:function(node,offset){return this.getNodeWrapper(node).getPosition(offset)},getRangeBoundaryPosition:function(range,isStart){var prefix=isStart?"start":"end";return this.getPosition(range[prefix+"Container"],range[prefix+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}};return Session}();function startSession(){endSession();return currentSession=new Session}function getSession(){return currentSession||startSession()}function endSession(){if(currentSession){currentSession.detach()}currentSession=null}extend(dom,{nextNode:nextNode,previousNode:previousNode});function createCharacterIterator(startPos,backward,endPos,characterOptions){if(endPos){if(backward){if(isCollapsedNode(endPos.node)){endPos=startPos.previousVisible()}}else{if(isCollapsedNode(endPos.node)){endPos=endPos.nextVisible()}}}var pos=startPos,finished=false;function next(){var charPos=null;if(backward){charPos=pos;if(!finished){pos=pos.previousVisible();finished=!pos||endPos&&pos.equals(endPos)}}else{if(!finished){charPos=pos=pos.nextVisible();finished=!pos||endPos&&pos.equals(endPos)}}if(finished){pos=null}return charPos}var previousTextPos,returnPreviousTextPos=false;return{next:function(){if(returnPreviousTextPos){returnPreviousTextPos=false;return previousTextPos}else{var pos,character;while(pos=next()){character=pos.getCharacter(characterOptions);if(character){previousTextPos=pos;return pos}}return null}},rewind:function(){if(previousTextPos){returnPreviousTextPos=true}else{throw module.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.")}},dispose:function(){startPos=endPos=null}}}var arrayIndexOf=Array.prototype.indexOf?function(arr,val){return arr.indexOf(val)}:function(arr,val){for(var i=0,len=arr.length;i<len;++i){if(arr[i]===val){return i}}return-1};function createTokenizedTextProvider(pos,characterOptions,wordOptions){var forwardIterator=createCharacterIterator(pos,false,null,characterOptions);var backwardIterator=createCharacterIterator(pos,true,null,characterOptions);var tokenizer=wordOptions.tokenizer;function consumeWord(forward){var pos,textChar;var newChars=[],it=forward?forwardIterator:backwardIterator;var passedWordBoundary=false,insideWord=false;while(pos=it.next()){textChar=pos.character;if(allWhiteSpaceRegex.test(textChar)){if(insideWord){insideWord=false;passedWordBoundary=true}}else{if(passedWordBoundary){it.rewind();break}else{insideWord=true}}newChars.push(pos)}return newChars}var forwardChars=consumeWord(true);var backwardChars=consumeWord(false).reverse();var tokens=tokenizer(backwardChars.concat(forwardChars),wordOptions);var forwardTokensBuffer=forwardChars.length?tokens.slice(arrayIndexOf(tokens,forwardChars[0].token)):[];var backwardTokensBuffer=backwardChars.length?tokens.slice(0,arrayIndexOf(tokens,backwardChars.pop().token)+1):[];function inspectBuffer(buffer){var textPositions=["["+buffer.length+"]"];for(var i=0;i<buffer.length;++i){textPositions.push("(word: "+buffer[i]+", is word: "+buffer[i].isWord+")")}return textPositions}return{nextEndToken:function(){var lastToken,forwardChars;while(forwardTokensBuffer.length==1&&!(lastToken=forwardTokensBuffer[0]).isWord&&(forwardChars=consumeWord(true)).length>0){forwardTokensBuffer=tokenizer(lastToken.chars.concat(forwardChars),wordOptions)}return forwardTokensBuffer.shift()},previousStartToken:function(){var lastToken,backwardChars;while(backwardTokensBuffer.length==1&&!(lastToken=backwardTokensBuffer[0]).isWord&&(backwardChars=consumeWord(false)).length>0){backwardTokensBuffer=tokenizer(backwardChars.reverse().concat(lastToken.chars),wordOptions)}return backwardTokensBuffer.pop()},dispose:function(){forwardIterator.dispose();backwardIterator.dispose();forwardTokensBuffer=backwardTokensBuffer=null}}}function movePositionBy(pos,unit,count,characterOptions,wordOptions){var unitsMoved=0,currentPos,newPos=pos,charIterator,nextPos,absCount=Math.abs(count),token;if(count!==0){var backward=count<0;switch(unit){case CHARACTER:charIterator=createCharacterIterator(pos,backward,null,characterOptions);while((currentPos=charIterator.next())&&unitsMoved<absCount){++unitsMoved;newPos=currentPos}nextPos=currentPos;charIterator.dispose();break;case WORD:var tokenizedTextProvider=createTokenizedTextProvider(pos,characterOptions,wordOptions);var next=backward?tokenizedTextProvider.previousStartToken:tokenizedTextProvider.nextEndToken;while((token=next())&&unitsMoved<absCount){if(token.isWord){++unitsMoved;newPos=backward?token.chars[0]:token.chars[token.chars.length-1]}}break;default:throw new Error("movePositionBy: unit '"+unit+"' not implemented")}if(backward){newPos=newPos.previousVisible();unitsMoved=-unitsMoved}else if(newPos&&newPos.isLeadingSpace){if(unit==WORD){charIterator=createCharacterIterator(pos,false,null,characterOptions);nextPos=charIterator.next();charIterator.dispose()}if(nextPos){newPos=nextPos.previousVisible()}}}return{position:newPos,unitsMoved:unitsMoved}}function createRangeCharacterIterator(session,range,characterOptions,backward){var rangeStart=session.getRangeBoundaryPosition(range,true);var rangeEnd=session.getRangeBoundaryPosition(range,false);var itStart=backward?rangeEnd:rangeStart;var itEnd=backward?rangeStart:rangeEnd;return createCharacterIterator(itStart,!!backward,itEnd,characterOptions)}function getRangeCharacters(session,range,characterOptions){var chars=[],it=createRangeCharacterIterator(session,range,characterOptions),pos;while(pos=it.next()){chars.push(pos)}it.dispose();return chars}function isWholeWord(startPos,endPos,wordOptions){var range=api.createRange(startPos.node);range.setStartAndEnd(startPos.node,startPos.offset,endPos.node,endPos.offset);var returnVal=!range.expand("word",wordOptions);return returnVal}function findTextFromPosition(initialPos,searchTerm,isRegex,searchScopeRange,findOptions){var backward=isDirectionBackward(findOptions.direction);var it=createCharacterIterator(initialPos,backward,initialPos.session.getRangeBoundaryPosition(searchScopeRange,backward),findOptions.characterOptions);var text="",chars=[],pos,currentChar,matchStartIndex,matchEndIndex;var result,insideRegexMatch;var returnValue=null;function handleMatch(startIndex,endIndex){var startPos=chars[startIndex].previousVisible();var endPos=chars[endIndex-1];var valid=!findOptions.wholeWordsOnly||isWholeWord(startPos,endPos,findOptions.wordOptions);return{startPos:startPos,endPos:endPos,valid:valid}}while(pos=it.next()){currentChar=pos.character;if(!isRegex&&!findOptions.caseSensitive){currentChar=currentChar.toLowerCase()}if(backward){chars.unshift(pos);text=currentChar+text}else{chars.push(pos);text+=currentChar}if(isRegex){result=searchTerm.exec(text);if(result){if(insideRegexMatch){matchStartIndex=result.index;matchEndIndex=matchStartIndex+result[0].length;if(!backward&&matchEndIndex<text.length||backward&&matchStartIndex>0){returnValue=handleMatch(matchStartIndex,matchEndIndex);break}}else{insideRegexMatch=true}}}else if((matchStartIndex=text.indexOf(searchTerm))!=-1){returnValue=handleMatch(matchStartIndex,matchStartIndex+searchTerm.length);break}}if(insideRegexMatch){returnValue=handleMatch(matchStartIndex,matchEndIndex)}it.dispose();return returnValue}function createEntryPointFunction(func){return function(){var sessionRunning=!!currentSession;var session=getSession();var args=[session].concat(util.toArray(arguments));var returnValue=func.apply(this,args);if(!sessionRunning){endSession()}return returnValue}}function createRangeBoundaryMover(isStart,collapse){return createEntryPointFunction(function(session,unit,count,moveOptions){if(typeof count=="undefined"){count=unit;unit=CHARACTER}moveOptions=createOptions(moveOptions,defaultMoveOptions);var characterOptions=createCharacterOptions(moveOptions.characterOptions);var wordOptions=createWordOptions(moveOptions.wordOptions);var boundaryIsStart=isStart;if(collapse){boundaryIsStart=count>=0;this.collapse(!boundaryIsStart)}var moveResult=movePositionBy(session.getRangeBoundaryPosition(this,boundaryIsStart),unit,count,characterOptions,wordOptions);var newPos=moveResult.position;this[boundaryIsStart?"setStart":"setEnd"](newPos.node,newPos.offset);return moveResult.unitsMoved})}function createRangeTrimmer(isStart){return createEntryPointFunction(function(session,characterOptions){characterOptions=createCharacterOptions(characterOptions);var pos;var it=createRangeCharacterIterator(session,this,characterOptions,!isStart);var trimCharCount=0;while((pos=it.next())&&allWhiteSpaceRegex.test(pos.character)){++trimCharCount}it.dispose();var trimmed=trimCharCount>0;if(trimmed){this[isStart?"moveStart":"moveEnd"]("character",isStart?trimCharCount:-trimCharCount,{characterOptions:characterOptions})}return trimmed})}extend(api.rangePrototype,{moveStart:createRangeBoundaryMover(true,false),moveEnd:createRangeBoundaryMover(false,false),move:createRangeBoundaryMover(true,true),trimStart:createRangeTrimmer(true),trimEnd:createRangeTrimmer(false),trim:createEntryPointFunction(function(session,characterOptions){var startTrimmed=this.trimStart(characterOptions),endTrimmed=this.trimEnd(characterOptions);return startTrimmed||endTrimmed}),expand:createEntryPointFunction(function(session,unit,expandOptions){var moved=false;expandOptions=createOptions(expandOptions,defaultExpandOptions);var characterOptions=createCharacterOptions(expandOptions.characterOptions);if(!unit){unit=CHARACTER}if(unit==WORD){var wordOptions=createWordOptions(expandOptions.wordOptions);var startPos=session.getRangeBoundaryPosition(this,true);var endPos=session.getRangeBoundaryPosition(this,false);var startTokenizedTextProvider=createTokenizedTextProvider(startPos,characterOptions,wordOptions);var startToken=startTokenizedTextProvider.nextEndToken();var newStartPos=startToken.chars[0].previousVisible();var endToken,newEndPos;if(this.collapsed){endToken=startToken}else{var endTokenizedTextProvider=createTokenizedTextProvider(endPos,characterOptions,wordOptions);endToken=endTokenizedTextProvider.previousStartToken()}newEndPos=endToken.chars[endToken.chars.length-1];if(!newStartPos.equals(startPos)){this.setStart(newStartPos.node,newStartPos.offset);moved=true}if(newEndPos&&!newEndPos.equals(endPos)){this.setEnd(newEndPos.node,newEndPos.offset);moved=true}if(expandOptions.trim){if(expandOptions.trimStart){moved=this.trimStart(characterOptions)||moved}if(expandOptions.trimEnd){moved=this.trimEnd(characterOptions)||moved}}return moved}else{return this.moveEnd(CHARACTER,1,expandOptions)}}),text:createEntryPointFunction(function(session,characterOptions){return this.collapsed?"":getRangeCharacters(session,this,createCharacterOptions(characterOptions)).join("")}),selectCharacters:createEntryPointFunction(function(session,containerNode,startIndex,endIndex,characterOptions){var moveOptions={characterOptions:characterOptions};if(!containerNode){containerNode=getBody(this.getDocument())}this.selectNodeContents(containerNode);this.collapse(true);this.moveStart("character",startIndex,moveOptions);this.collapse(true);this.moveEnd("character",endIndex-startIndex,moveOptions)}),toCharacterRange:createEntryPointFunction(function(session,containerNode,characterOptions){if(!containerNode){containerNode=getBody(this.getDocument())}var parent=containerNode.parentNode,nodeIndex=dom.getNodeIndex(containerNode);var rangeStartsBeforeNode=dom.comparePoints(this.startContainer,this.endContainer,parent,nodeIndex)==-1;var rangeBetween=this.cloneRange();var startIndex,endIndex;if(rangeStartsBeforeNode){rangeBetween.setStartAndEnd(this.startContainer,this.startOffset,parent,nodeIndex);startIndex=-rangeBetween.text(characterOptions).length}else{rangeBetween.setStartAndEnd(parent,nodeIndex,this.startContainer,this.startOffset);startIndex=rangeBetween.text(characterOptions).length}endIndex=startIndex+this.text(characterOptions).length;return{start:startIndex,end:endIndex}}),findText:createEntryPointFunction(function(session,searchTermParam,findOptions){findOptions=createFindOptions(findOptions);if(findOptions.wholeWordsOnly){findOptions.wordOptions=createWordOptions(findOptions.wordOptions);findOptions.wordOptions.includeTrailingSpace=false}var backward=isDirectionBackward(findOptions.direction);var searchScopeRange=findOptions.withinRange;if(!searchScopeRange){searchScopeRange=api.createRange();searchScopeRange.selectNodeContents(this.getDocument())}var searchTerm=searchTermParam,isRegex=false;if(typeof searchTerm=="string"){if(!findOptions.caseSensitive){searchTerm=searchTerm.toLowerCase()}}else{isRegex=true}var initialPos=session.getRangeBoundaryPosition(this,!backward);var comparison=searchScopeRange.comparePoint(initialPos.node,initialPos.offset);if(comparison===-1){initialPos=session.getRangeBoundaryPosition(searchScopeRange,true)}else if(comparison===1){initialPos=session.getRangeBoundaryPosition(searchScopeRange,false)}var pos=initialPos;var wrappedAround=false;var findResult;while(true){findResult=findTextFromPosition(pos,searchTerm,isRegex,searchScopeRange,findOptions);if(findResult){if(findResult.valid){this.setStartAndEnd(findResult.startPos.node,findResult.startPos.offset,findResult.endPos.node,findResult.endPos.offset);return true}else{pos=backward?findResult.startPos:findResult.endPos}}else if(findOptions.wrap&&!wrappedAround){searchScopeRange=searchScopeRange.cloneRange();pos=session.getRangeBoundaryPosition(searchScopeRange,!backward);searchScopeRange.setBoundary(initialPos.node,initialPos.offset,backward);wrappedAround=true}else{return false}}}),pasteHtml:function(html){this.deleteContents();if(html){var frag=this.createContextualFragment(html);var lastChild=frag.lastChild;this.insertNode(frag);this.collapseAfter(lastChild)}}});function createSelectionTrimmer(methodName){return createEntryPointFunction(function(session,characterOptions){var trimmed=false;this.changeEachRange(function(range){trimmed=range[methodName](characterOptions)||trimmed});return trimmed})}extend(api.selectionPrototype,{expand:createEntryPointFunction(function(session,unit,expandOptions){this.changeEachRange(function(range){range.expand(unit,expandOptions)})}),move:createEntryPointFunction(function(session,unit,count,options){var unitsMoved=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var range=this.getRangeAt(0);if(!options){options={}}options.characterOptions=createCaretCharacterOptions(options.characterOptions);unitsMoved=range.move(unit,count,options);this.setSingleRange(range)}return unitsMoved}),trimStart:createSelectionTrimmer("trimStart"),trimEnd:createSelectionTrimmer("trimEnd"),trim:createSelectionTrimmer("trim"),selectCharacters:createEntryPointFunction(function(session,containerNode,startIndex,endIndex,direction,characterOptions){var range=api.createRange(containerNode);range.selectCharacters(containerNode,startIndex,endIndex,characterOptions);this.setSingleRange(range,direction)}),saveCharacterRanges:createEntryPointFunction(function(session,containerNode,characterOptions){var ranges=this.getAllRanges(),rangeCount=ranges.length;var rangeInfos=[];var backward=rangeCount==1&&this.isBackward();for(var i=0,len=ranges.length;i<len;++i){rangeInfos[i]={characterRange:ranges[i].toCharacterRange(containerNode,characterOptions),backward:backward,characterOptions:characterOptions}}return rangeInfos}),restoreCharacterRanges:createEntryPointFunction(function(session,containerNode,saved){this.removeAllRanges();for(var i=0,len=saved.length,range,rangeInfo,characterRange;i<len;++i){rangeInfo=saved[i];characterRange=rangeInfo.characterRange;range=api.createRange(containerNode);range.selectCharacters(containerNode,characterRange.start,characterRange.end,rangeInfo.characterOptions);this.addRange(range,rangeInfo.backward)}}),text:createEntryPointFunction(function(session,characterOptions){var rangeTexts=[];for(var i=0,len=this.rangeCount;i<len;++i){rangeTexts[i]=this.getRangeAt(i).text(characterOptions)}return rangeTexts.join("")})});api.innerText=function(el,characterOptions){var range=api.createRange(el);range.selectNodeContents(el);var text=range.text(characterOptions);return text};api.createWordIterator=function(startNode,startOffset,iteratorOptions){var session=getSession();iteratorOptions=createOptions(iteratorOptions,defaultWordIteratorOptions);var characterOptions=createCharacterOptions(iteratorOptions.characterOptions);var wordOptions=createWordOptions(iteratorOptions.wordOptions);var startPos=session.getPosition(startNode,startOffset);var tokenizedTextProvider=createTokenizedTextProvider(startPos,characterOptions,wordOptions);var backward=isDirectionBackward(iteratorOptions.direction);return{next:function(){return backward?tokenizedTextProvider.previousStartToken():tokenizedTextProvider.nextEndToken()},dispose:function(){tokenizedTextProvider.dispose();this.next=function(){}}}};api.noMutation=function(func){var session=getSession();func(session);endSession()};api.noMutation.createEntryPointFunction=createEntryPointFunction;api.textRange={isBlockNode:isBlockNode,isCollapsedWhitespaceNode:isCollapsedWhitespaceNode,createPosition:createEntryPointFunction(function(session,node,offset){return session.getPosition(node,offset)})}})},function(f){return f("return this;")()}(Function))}});require.register({"lib/bootstrap-dropdown":function(exports,require,module){!function($){"use strict";var toggle="[data-toggle=dropdown]",Dropdown=function(element){var $el=$(element).on("click.dropdown.data-api",this.toggle);$("html").on("click.dropdown.data-api",function(){$el.parent().removeClass("open")})};Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),$parent,isActive;if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");clearMenus();if(!isActive){$parent.toggleClass("open");$this.focus()}return false},keydown:function(e){var $this,$items,$active,$parent,isActive,index;if(!/(38|40|27)/.test(e.keyCode))return;$this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");if(!isActive||isActive&&e.keyCode==27)return $this.click();$items=$("[role=menu] li:not(.divider) a",$parent);if(!$items.length)return;index=$items.index($items.filter(":focus"));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus()}};function clearMenus(){$(toggle).each(function(){getParent($(this)).removeClass("open")})}function getParent($this){var selector=$this.attr("data-target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);$parent.length||($parent=$this.parent());return $parent}$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$(document).on("click.dropdown.data-api touchstart.dropdown.data-api",clearMenus).on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",toggle+", [role=menu]",Dropdown.prototype.keydown)}(window.jQuery)}});require.register({"lib/bootstrap-tooltip":function(exports,require,module){!function($){"use strict";var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;if(this.options.trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(this.options.trigger!="manual"){eventIn=this.options.trigger=="hover"?"mouseenter":"focus";eventOut=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.$element.data());if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(this.timeout)clearTimeout(this.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState="out";this.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass("fade")}placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;inside=/in/.test(placement);$tip.detach().css({top:0,left:0,display:"block"}).insertAfter(this.$element);pos=this.getPosition(inside);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(inside?placement.split(" ")[1]:placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}$tip.offset(tp).addClass(placement).addClass("in")}},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){var that=this,$tip=this.tip();$tip.removeClass("in");function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).detach()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.detach()})}$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.detach();return this},fixTitle:function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},inside?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);self[self.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options=typeof option=="object"&&option;if(!data)$this.data("tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:false}}(window.jQuery)}});require.register({"lib/bootstrap-popover":function(exports,require,module){!function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype,{constructor:Popover,setContent:function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title);$tip.find(".popover-content > *")[this.options.html?"html":"text"](content);$tip.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var content,$e=this.$element,o=this.options;content=$e.attr("data-content")||(typeof o.content=="function"?o.content.call($e[0]):o.content);return content},tip:function(){if(!this.$tip){this.$tip=$(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});$.fn.popover=function(option){return this.each(function(){var $this=$(this),data=$this.data("popover"),options=typeof option=="object"&&option;if(!data)$this.data("popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})};$.fn.popover.Constructor=Popover;$.fn.popover.defaults=$.extend({},$.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery)}});require.register({"lib/bootstrap-modal":function(exports,require,module){!function($){"use strict";var Modal=function(element,options){this.options=options;this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};Modal.prototype={constructor:Modal,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(document.body)}that.$element.show();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in").attr("aria-hidden",false);that.enforceFocus();transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger("shown")}):that.$element.focus().trigger("shown")})},hide:function(e){e&&e.preventDefault();var that=this;e=$.Event("hide");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",true);$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var that=this;$(document).on("focusin.modal",function(e){if(that.$element[0]!==e.target&&!that.$element.has(e.target).length){that.$element.focus()}})},escape:function(){var that=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(e){e.which==27&&that.hide()})}else if(!this.isShown){this.$element.off("keyup.dismiss.modal")}},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);that.hideModal()})},hideModal:function(that){this.$element.hide().trigger("hidden");this.backdrop()},removeBackdrop:function(){this.$backdrop.remove();this.$backdrop=null},backdrop:function(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";

if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,$.proxy(this.removeBackdrop,this)):this.removeBackdrop()}else if(callback){callback()}}};$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string")data[option]();else if(options.show)data.show()})};$.fn.modal.defaults={backdrop:true,keyboard:true,show:true};$.fn.modal.Constructor=Modal;$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option).one("hide",function(){$this.focus()})})}(window.jQuery)}});require.register({"src/DSt":function(exports,require,module){module.exports.DSt=function(){var a={version:.002005,get:function(b){var c=localStorage.getItem(b);if(c===undefined||c===null){c="null"}else{c=c.toString()}return JSON.parse(c)},set:function(b,c){return localStorage.setItem(b,JSON.stringify(c))},store:function(b){if(typeof b=="string"){b=document.getElementById(b)}if(!b||b.name==""){return this}var c=a._form_elt_key(b);if(b.type=="checkbox"){a.set(c,b.checked?1:0)}else{if(b.type=="radio"){a.set(c,a._radio_value(b))}else{a.set(c,b.value||"")}}return this},recall:function(b){if(typeof b=="string"){b=document.getElementById(b)}if(!b||b.name==""){return this}var c=a._form_elt_key(b);var d=a.get(c);if(b.type=="checkbox"){b.checked=!!d}else{if(b.type=="radio"){if(b.value==d){b.checked=true}}else{b.value=d||""}}return this},_form_elt_key:function(b){return"_form_"+b.form.name+"_field_"+b.name},_radio_value:function(e){if(typeof e=="string"){e=document.getElementById(e)}var f=e.form.elements[e.name];var b=f.length;var d=null;for(var c=0;c<b;c++){if(f[c].checked){d=f[c].value}}return d},recall_form:function(b){return a._apply_fn_to_form_inputs(b,a.recall)},store_form:function(b){return a._apply_fn_to_form_inputs(b,a.store)},_apply_fn_to_form_inputs:function(e,c){if(typeof e=="string"){e=document.getElementById(e)}var f=e.elements.length;for(var b=0;b<f;b++){var d=e.elements[b];if(d.tagName=="TEXTAREA"||d.tagName=="INPUT"&&d.type!="file"&&d.type!="button"&&d.type!="image"&&d.type!="password"&&d.type!="submit"&&d.type!="reset"){c(d)}}return this},_storage_types:function(){var b="";for(var c in window){if(c=="sessionStorage"||c=="globalStorage"||c=="localStorage"||c=="openDatabase"){b+=b?" "+c:c}}return b},javascript_accepts_trailing_comma:false};return a}()}});require.register({"lib/underscore":function(exports,require,module){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.7.0";var createCallback=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};_.iteratee=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return createCallback(value,context,argCount);if(_.isObject(value))return _.matches(value);return _.property(value)};_.each=_.forEach=function(obj,iteratee,context){if(obj==null)return obj;iteratee=createCallback(iteratee,context);var i,length=obj.length;if(length===+length){for(i=0;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){if(obj==null)return[];iteratee=_.iteratee(iteratee,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,results=Array(length),currentKey;for(var index=0;index<length;index++){currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iteratee,memo,context){if(obj==null)obj=[];iteratee=createCallback(iteratee,context,4);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index=0,currentKey;if(arguments.length<3){if(!length)throw new TypeError(reduceError);memo=obj[keys?keys[index++]:index++]}for(;index<length;index++){currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo};_.reduceRight=_.foldr=function(obj,iteratee,memo,context){if(obj==null)obj=[];iteratee=createCallback(iteratee,context,4);var keys=obj.length!==+obj.length&&_.keys(obj),index=(keys||obj).length,currentKey;if(arguments.length<3){if(!index)throw new TypeError(reduceError);memo=obj[keys?keys[--index]:--index]}while(index--){currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo};_.find=_.detect=function(obj,predicate,context){var result;predicate=_.iteratee(predicate,context);_.some(obj,function(value,index,list){if(predicate(value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;predicate=_.iteratee(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(_.iteratee(predicate)),context)};_.every=_.all=function(obj,predicate,context){if(obj==null)return true;predicate=_.iteratee(predicate,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index,currentKey;for(index=0;index<length;index++){currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){if(obj==null)return false;predicate=_.iteratee(predicate,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index,currentKey;for(index=0;index<length;index++){currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.include=function(obj,target){if(obj==null)return false;if(obj.length!==+obj.length)obj=_.values(obj);return _.indexOf(obj,target)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=obj&&obj.length===+obj.length?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=_.iteratee(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.sortedIndex=function(array,obj,iteratee,context){iteratee=_.iteratee(iteratee,context,1);var value=iteratee(obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=_.iteratee(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}for(var i=0,length=input.length;i<length;i++){var value=input[i];if(!_.isArray(value)&&!_.isArguments(value)){if(!strict)output.push(value)}else if(shallow){push.apply(output,value)}else{flatten(value,shallow,strict,output)}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(array==null)return[];if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=_.iteratee(iteratee,context);var result=[];var seen=[];for(var i=0,length=array.length;i<length;i++){var value=array[i];if(isSorted){if(!i||seen!==value)result.push(value);seen=value}else if(iteratee){var computed=iteratee(value,i,array);if(_.indexOf(seen,computed)<0){seen.push(computed);result.push(value)}}else if(_.indexOf(result,value)<0){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true,[]))};_.intersection=function(array){if(array==null)return[];var result=[];var argsLength=arguments.length;for(var i=0,length=array.length;i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(slice.call(arguments,1),true,true,[]);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(array){if(array==null)return[];var length=_.max(arguments,"length").length;var results=Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,length+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}for(;i<length;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var idx=array.length;if(typeof from=="number"){idx=from<0?idx+from+1:Math.min(idx,from+1)}while(--idx>=0)if(array[idx]===item)return idx;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var Ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");args=slice.call(arguments,2);bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));Ctor.prototype=func.prototype;var self=new Ctor;Ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(_.isObject(result))return result;return self};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++]}while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args)}};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=hasher?hasher.apply(this,arguments):key;if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}else{func=null}return memo}};_.once=_.partial(_.before,2);_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){if(!_.isObject(obj))return obj;var source,prop;for(var i=1,length=arguments.length;i<length;i++){source=arguments[i];for(prop in source){if(hasOwnProperty.call(source,prop)){obj[prop]=source[prop]}}}return obj};_.pick=function(obj,iteratee,context){var result={},key;if(obj==null)return result;if(_.isFunction(iteratee)){iteratee=createCallback(iteratee,context);for(key in obj){var value=obj[key];if(iteratee(value,key,obj))result[key]=value}}else{var keys=concat.apply([],slice.call(arguments,1));obj=new Object(obj);for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(key in obj)result[key]=obj[key]}}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(concat.apply([],slice.call(arguments,1)),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=function(obj){if(!_.isObject(obj))return obj;for(var i=1,length=arguments.length;i<length;i++){var source=arguments[i];for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&"constructor"in a&&"constructor"in b&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false}aStack.push(a);bStack.push(b);var size,result;if(className==="[object Array]"){size=a.length;result=size===b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{var keys=_.keys(a),key;size=keys.length;result=_.keys(b).length===size;if(result){while(size--){key=keys[size];if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){var pairs=_.pairs(attrs),length=pairs.length;return function(obj){if(obj==null)return!length;obj=new Object(obj);for(var i=0;i<length;i++){var pair=pairs[i],key=pair[0];if(pair[1]!==obj[key]||!(key in obj))return false}return true}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=createCallback(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?object[property]():value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)}});require.register({"lib/semver":function(exports,require,module){(function(exports){var semver="\\s*[v=]*\\s*([0-9]+)"+"\\.([0-9]+)"+"\\.([0-9]+)"+"(-[0-9]+-?)?"+"([a-zA-Z-+][a-zA-Z0-9-.:]*)?",exprComparator="^((<|>)?=?)s*("+semver+")$|^$",xRangePlain="[v=]*([0-9]+|x|X|\\*)"+"(?:\\.([0-9]+|x|X|\\*)"+"(?:\\.([0-9]+|x|X|\\*)"+"([a-zA-Z-][a-zA-Z0-9-.:]*)?)?)?",xRange="((?:<|>)=?)?\\s*"+xRangePlain,exprLoneSpermy="(?:~>?)",exprSpermy=exprLoneSpermy+xRange,expressions=exports.expressions={parse:new RegExp("^\\s*"+semver+"\\s*$"),parsePackage:new RegExp("^\\s*([^/]+)[-@]("+semver+")\\s*$"),parseRange:new RegExp("^\\s*("+semver+")\\s+-\\s+("+semver+")\\s*$"),validComparator:new RegExp("^"+exprComparator+"$"),parseXRange:new RegExp("^"+xRange+"$"),parseSpermy:new RegExp("^"+exprSpermy+"$")};Object.getOwnPropertyNames(expressions).forEach(function(i){exports[i]=function(str){return(""+(str||"")).match(expressions[i])}});exports.rangeReplace=">=$1 <=$7";exports.clean=clean;exports.compare=compare;exports.rcompare=rcompare;exports.satisfies=satisfies;exports.gt=gt;exports.gte=gte;exports.lt=lt;exports.lte=lte;exports.eq=eq;exports.neq=neq;exports.cmp=cmp;exports.inc=inc;exports.valid=valid;exports.validPackage=validPackage;exports.validRange=validRange;exports.maxSatisfying=maxSatisfying;exports.replaceStars=replaceStars;exports.toComparators=toComparators;function stringify(version){var v=version;return[v[1]||"",v[2]||"",v[3]||""].join(".")+(v[4]||"")+(v[5]||"")}function clean(version){version=exports.parse(version);if(!version)return version;return stringify(version)}function valid(version){if(typeof version!=="string")return null;return exports.parse(version)&&version.trim().replace(/^[v=]+/,"")}function validPackage(version){if(typeof version!=="string")return null;return version.match(expressions.parsePackage)&&version.trim()}var starExpression=/(<|>)?=?\s*\*/g,starReplace="",compTrimExpression=new RegExp("((<|>)?=|<|>)\\s*("+semver+"|"+xRangePlain+")","g"),compTrimReplace="$1$3";function toComparators(range){var ret=(range||"").trim().replace(expressions.parseRange,exports.rangeReplace).replace(compTrimExpression,compTrimReplace).split(/\s+/).join(" ").split("||").map(function(orchunk){return orchunk.replace(new RegExp("("+exprLoneSpermy+")\\s+"),"$1").split(" ").map(replaceXRanges).map(replaceSpermies).map(replaceStars).join(" ").trim()}).map(function(orchunk){return orchunk.trim().split(/\s+/).filter(function(c){return c.match(expressions.validComparator)})}).filter(function(c){return c.length});return ret}function replaceStars(stars){return stars.trim().replace(starExpression,starReplace)}function replaceXRanges(ranges){return ranges.split(/\s+/).map(replaceXRange).join(" ")}function replaceXRange(version){return version.trim().replace(expressions.parseXRange,function(v,gtlt,M,m,p,t){var anyX=!M||M.toLowerCase()==="x"||M==="*"||!m||m.toLowerCase()==="x"||m==="*"||!p||p.toLowerCase()==="x"||p==="*",ret=v;if(gtlt&&anyX){(!M||M==="*"||M.toLowerCase()==="x")&&(M=0);(!m||m==="*"||m.toLowerCase()==="x")&&(m=0);(!p||p==="*"||p.toLowerCase()==="x")&&(p=0);ret=gtlt+M+"."+m+"."+p+"-"}else if(!M||M==="*"||M.toLowerCase()==="x"){ret="*"}else if(!m||m==="*"||m.toLowerCase()==="x"){ret=">="+M+".0.0- <"+(+M+1)+".0.0-"}else if(!p||p==="*"||p.toLowerCase()==="x"){ret=">="+M+"."+m+".0- <"+M+"."+(+m+1)+".0-"}return ret})}function replaceSpermies(version){return version.trim().replace(expressions.parseSpermy,function(v,gtlt,M,m,p,t){if(gtlt)throw new Error("Using '"+gtlt+"' with ~ makes no sense. Don't do it.");if(!M||M.toLowerCase()==="x"){return""}if(!m||m.toLowerCase()==="x"){return">="+M+".0.0- <"+(+M+1)+".0.0-"}if(!p||p.toLowerCase()==="x"){return">="+M+"."+m+".0- <"+M+"."+(+m+1)+".0-"}t=t||"-";return">="+M+"."+m+"."+p+t+" <"+M+"."+(+m+1)+".0-"})}function validRange(range){range=replaceStars(range);var c=toComparators(range);return c.length===0?null:c.map(function(c){return c.join(" ")}).join("||")}function maxSatisfying(versions,range){return versions.filter(function(v){return satisfies(v,range)}).sort(compare).pop()}function satisfies(version,range){version=valid(version);if(!version)return false;range=toComparators(range);for(var i=0,l=range.length;i<l;i++){var ok=false;for(var j=0,ll=range[i].length;j<ll;j++){var r=range[i][j],gtlt=r.charAt(0)===">"?gt:r.charAt(0)==="<"?lt:false,eq=r.charAt(!!gtlt)==="=",sub=!!eq+!!gtlt;if(!gtlt)eq=true;r=r.substr(sub);r=r===""?r:valid(r);ok=r===""||eq&&r===version||gtlt&&gtlt(version,r);if(!ok)break}if(ok)return true}return false}function compare(v1,v2){var g=gt(v1,v2);return g===null?0:g?1:-1}function rcompare(v1,v2){return compare(v2,v1)}function lt(v1,v2){return gt(v2,v1)}function gte(v1,v2){return!lt(v1,v2)}function lte(v1,v2){return!gt(v1,v2)}function eq(v1,v2){return gt(v1,v2)===null}function neq(v1,v2){return gt(v1,v2)!==null}function cmp(v1,c,v2){switch(c){case">":return gt(v1,v2);case"<":return lt(v1,v2);case">=":return gte(v1,v2);case"<=":return lte(v1,v2);case"==":return eq(v1,v2);case"!=":return neq(v1,v2);case"===":return v1===v2;case"!==":return v1!==v2;default:throw new Error("Y U NO USE VALID COMPARATOR!? "+c)}}function num(v){return v===undefined?-1:parseInt((v||"0").replace(/[^0-9]+/g,""),10)}function gt(v1,v2){v1=exports.parse(v1);v2=exports.parse(v2);if(!v1||!v2)return false;for(var i=1;i<5;i++){v1[i]=num(v1[i]);v2[i]=num(v2[i]);if(v1[i]>v2[i])return true;else if(v1[i]!==v2[i])return false}var tag1=v1[5]||"",tag2=v2[5]||"";return tag1===tag2?null:!tag1?true:!tag2?false:tag1>tag2}function inc(version,release){version=exports.parse(version);if(!version)return null;var parsedIndexLookup={
major:1,minor:2,patch:3,build:4};var incIndex=parsedIndexLookup[release];if(incIndex===undefined)return null;var current=num(version[incIndex]);version[incIndex]=current===-1?1:current+1;for(var i=incIndex+1;i<5;i++){if(num(version[i])!==-1)version[i]="0"}if(version[4])version[4]="-"+version[4];version[5]="";return stringify(version)}})(typeof exports==="object"?exports:semver={})}});require.register({"src/application":function(exports,require,module){var Application,FakeGetText,JQPlugin,JQZIndex,rangy,rangyTextRange;Array.prototype.zipPermutations=function(right_list){var combine,combined,l,leftPermutations,left_list,lefts,r,rightPermutations,rights,_i,_j,_k,_l,_len,_len1,_len2,_len3;left_list=this;leftPermutations=function(sublist){var perms,x,_i;perms=[];for(x in _.range(1,sublist.length+1)){_i=-Math.abs(x);if(x>0){perms.push(sublist.slice(_i))}}perms.push(sublist);return perms};rightPermutations=function(sublist){var perms,x;perms=[];for(x in _.range(1,sublist.length+1)){if(x>0){perms.push(sublist.slice(0,x))}}perms.push(sublist);return perms};lefts=leftPermutations(left_list);rights=rightPermutations(right_list);combined=[];for(_i=0,_len=lefts.length;_i<_len;_i++){l=lefts[_i];combined.push(l)}for(_j=0,_len1=lefts.length;_j<_len1;_j++){l=lefts[_j];for(_k=0,_len2=rights.length;_k<_len2;_k++){r=rights[_k];combine=l.concat(r);combined.push(combine)}}for(_l=0,_len3=rights.length;_l<_len3;_l++){r=rights[_l];combined.push(r)}return combined};String.prototype.startsWith=function(str){return this.slice(0,str.length)===str};String.prototype.endsWith=function(str){return this.slice(-str.length)===str};JQZIndex=require("lib/jquery.topZindex");JQPlugin=require("src/jquery.neahttadigisanit");FakeGetText=require("src/localization");rangy=require("rangy");rangyTextRange=require("rangy-textrange");module.exports=Application=function(){function Application(){var rangz;this.$=jQuery;this.options={};console.log("Initializing NDS.");if(window.rangy!=null){rangz=window.rangy}else if(rangy!=null){rangz=rangy}if(rangz.init!=null){console.log("found rangy");rangz.init()}else{console.log("couldn't find rangy")}}return Application}()}});require.register({"src/dictionary":function(exports,require,module){var DictionaryAPI;module.exports=DictionaryAPI=function(){function DictionaryAPI(configs){this.host=configs.host}DictionaryAPI.prototype.readConfig=function(callback){return false};DictionaryAPI.prototype.lookup=function(source_lang,target_lang,string,callback){var callback_func,post_data,url;if(callback==null){callback=false}post_data={lookup:string,lemmatize:true};url=""+this.host+"/lookup/"+source_lang+"/"+target_lang+"/"+"?callback=?";if(!callback){callback_func=function(r){return console.log(r)}}else{callback_func=callback}return $.post(url+"?callback=?",post_data,callback_func)};return DictionaryAPI}()}});require.register({"src/selection":function(exports,require,module){var Selection,rangy,rangy_textrange;rangy=require("rangy");rangy_textrange=require("rangy-textrange");module.exports=Selection=function(){function Selection(){}Selection.prototype.expandByWordRegex=function(selection){var opts,word_opts,word_regex;opts=$.fn.getCurrentDictOpts().settings;word_opts={};if(!window.word_regex){word_regex=new RegExp(opts.word_regex,opts.word_regex_opts);window.word_regex=word_regex}else{word_regex=window.word_regex}word_opts.trim=true;word_opts.wordOptions={wordRegex:word_regex};selection.expand("word",word_opts);return selection};Selection.prototype.getParentFullText=function(selection){var range;range=selection.rangeCount?selection.getRangeAt(0):null;if(range){return rangy.innerText(range.commonAncestorContainer)}else{return false}};Selection.prototype.getFirstRange=function(){var current_range_obj,full_text,opts,sel;opts=NDS.$.fn.getCurrentDictOpts().settings;sel=rangy.getSelection();if(opts){if(opts.word_regex&&opts.word_regex_opts){sel=this.expandByWordRegex(sel)}}full_text=this.getParentFullText(sel);current_range_obj=sel.rangeCount?sel.getRangeAt(0):null;window.selected_range=current_range_obj;window.previous_contents=window.selected_range.commonAncestorContainer.innerHTML;return[current_range_obj,full_text]};Selection.prototype.cloneContents=function(range){return range.cloneContents().textContent};Selection.prototype.getIndexes=function(){var node,ranges;node=window.selected_range.commonAncestorContainer;ranges=window.selected_range.toCharacterRange(node);return[ranges.start,ranges.end]};Selection.prototype.getPartitionedSelection=function(){var after,before,ind,partition,t;t=rangy.innerText(window.selected_range.startContainer);ind=this.getIndexes();before=t.slice(0,ind[0]);partition=t.slice(ind[0],ind[1]);after=t.slice(ind[1]);return[before,partition,after]};Selection.prototype.getPreviousWords=function(n){var before,selected_words,_,_ref;if(n==null){n=1}_ref=this.getPartitionedSelection(),before=_ref[0],_=_ref[1],_=_ref[2];before=before.match(window.word_regex);if(before){selected_words=before.slice(parseInt("-"+n))}else{selected_words=[]}return selected_words};Selection.prototype.getMultiwordEnvironment=function(l,r,t){var combinations,following_words,previous_words;if(l==null){l=1}if(r==null){r=1}if(t==null){t="#LOOKUP#"}previous_words=this.getPreviousWords(l);following_words=this.getNextWords(r);if(previous_words.length>0){previous_words.push(t)}else if(previous_words.length===0&&following_words.length>0){following_words.unshift(t)}combinations=previous_words.zipPermutations(following_words);return combinations};Selection.prototype.getMultiwordPermutations=function(l,r){var joined,mw,mws,t,word_delimiter,_i,_len,_mw;if(l==null){l=1}if(r==null){r=1}t=window.selected_range.text();mws=this.getMultiwordEnvironment(l,r,t);word_delimiter=" ";joined=[];for(_i=0,_len=mws.length;_i<_len;_i++){mw=mws[_i];_mw=mw.join(word_delimiter);if(_mw.length>0&&_mw.search(t)>-1){joined.push(_mw)}}joined=_.uniq(joined);return joined};Selection.prototype.getNextWords=function(n){var after,selected_words,_,_ref;if(n==null){n=1}_ref=this.getPartitionedSelection(),_=_ref[0],_=_ref[1],after=_ref[2];after=after.match(window.word_regex);if(after){selected_words=after.slice(0,n)}else{selected_words=[]}return selected_words};Selection.prototype.cleanRange=function(){if(window.selected_range){window.selected_range.commonAncestorContainer.normalize()}return true};Selection.prototype.surroundRange=function(range,surrounder){var ex;if(range){if(!range.canSurroundContents()){return false}try{return range.surroundContents(surrounder)}catch(_error){ex=_error;if((ex instanceof rangy.RangeException||Object.prototype.toString.call(ex)==="[object RangeException]")&&ex.code===1){return alert("Unable to surround range because range partially selects a\nnon-text node. See DOM Level 2 Range spec for more\ninformation.\n\n"+ex)}else{return alert("Unexpected errror: "+ex)}}}};return Selection}()}});require.register({"src/templates":function(exports,require,module){var BSDropdown,BSModal,BSPopover,BSTooltip,DSt,Templates,_,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_=require("./localization");BSDropdown=require("../lib/bootstrap-dropdown");BSModal=require("../lib/bootstrap-modal");BSTooltip=require("../lib/bootstrap-tooltip");BSPopover=require("../lib/bootstrap-popover");DSt=require("./DSt").DSt;module.exports=Templates=function(){function Templates(){}Templates.prototype.renderPopup=function(response,selection){var clean_right,current_pair_names,element,first,i,l,langpair,longest_input,lookup,matches_differ_from_click,multiple_inputs,opts,r,range,result,result_string,result_strings,right,string,_cp,_f_from,_i,_inputs,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_t_to,_tooltipTarget,_tooltipTitle,_this=this;first=function(somearray){if(somearray.length>0){return somearray[0]}else{return false}};opts=NDS.options;string=selection.string;element=selection.element;range=selection.range;matches_differ_from_click=false;longest_input=string;_inputs={};_ref=response.result;for(_i=0,_len=_ref.length;_i<_len;_i++){r=_ref[_i];_ref1=r.lookups;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){l=_ref1[_j];_inputs[l.input]=true;if(l.input.length>longest_input.length){longest_input=l.input}if(string!==l.input){matches_differ_from_click=true}}}multiple_inputs=Object.keys(_inputs).length>1?true:false;result_strings=[];_ref2=response.result;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){result=_ref2[_k];_ref3=result.lookups;for(_l=0,_len3=_ref3.length;_l<_len3;_l++){lookup=_ref3[_l];if(lookup.right.length>1){clean_right=[];_ref4=lookup.right;for(i=_m=0,_len4=_ref4.length;_m<_len4;i=++_m){r=_ref4[i];clean_right.push(""+(i+1)+". "+r)}right=clean_right.join(", ")}else{right=lookup.right[0]}result_string="<em>"+lookup.left+"</em> ("+lookup.pos+") &mdash; "+right;if(__indexOf.call(result_strings,result_string)<0){result_strings.push(result_string)}}}langpair=DSt.get(NDS_SHORT_NAME+"-"+"digisanit-select-langpair");_ref5=langpair.split("-"),_f_from=_ref5[0],_t_to=_ref5[1];_cp=first(NDS.options.dictionaries.filter(function(e){return e.from.iso===_f_from&&e.to.iso===_t_to}));if(_cp){current_pair_names=""+_cp.from.name+"  "+_cp.to.name}else{current_pair_names=""}if(result_strings.length===0||response.success===false){if(opts.tooltip){_tooltipTitle=_("Unknown word");result_strings.push("<span class='tags'><em>"+_("You are using")+" "+current_pair_names+"</em></span>");if(response.tags.length>0){_tooltipTitle=_("Meaning not found")}}}if(opts.tooltip){if(!_tooltipTitle){_tooltipTitle=string}if(_tooltipTitle!==longest_input){_tooltipTitle=""+_tooltipTitle+" &rarr; "+longest_input}_tooltipTarget=$(element).find("a.tooltip_target");_tooltipTarget.popover({title:_tooltipTitle,content:$("<p />").html(result_strings.join("<br />")).html(),html:true,placement:function(){if(_tooltipTarget[0].offsetLeft<125){return"right"}else{return"bottom"}},trigger:"hover"});if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}else if(document.selection){document.selection.empty()}return _tooltipTarget.popover("show")}};Templates.prototype.NotifyWindow=function(text){return $('<div class="modal hide fade" id="notifications">\n    <div class="modal-header">\n        <button\n            type="button"\n            class="close"\n            data-dismiss="modal"\n            aria-hidden="true">&times;</button>\n        <h3>Neahttadigisnit</h3>\n    </div>\n    <div class="modal-body">'+text+'</div>\n    <div class="modal-footer">\n        <a href="#" class="btn btn-primary" id="close_modal">\n          Continue\n        </a>\n    </div>\n</div>')};Templates.prototype.OptionsTab=function(opts){var el,makeLanguageOption;makeLanguageOption=function(options){var data,groups,i,in_group,options_block,_i,_j,_len,_len1;groups=function(){var _i,_len,_results;_results=[];for(i=_i=0,_len=options.length;_i<_len;i=++_i){data=options[i];_results.push(data.group)}return _results}().length>1;options_block=[];if(groups){in_group=false;for(i=_i=0,_len=options.length;_i<_len;i=++_i){data=options[i];if(data.group){if(!in_group){options_block.push("</optgroup>")}options_block.push('<optgroup label="'+data.group.self_name+'">');in_group=true}options_block.push('<option value="'+data.from.iso+"-"+data.to.iso+'">\n'+data.from.name+"  "+data.to.name+"\n</option>")}options_block.push("</optgroup>")}else{for(i=_j=0,_len1=options.length;_j<_len1;i=++_j){data=options[i];options_block.push('<option value="'+data.from.iso+"-"+data.to.iso+'">\n'+data.from.name+"  "+data.to.name+"\n</option>")}}return options_block.join("\n")};el=$('<div id="webdict_options">\n  <div class="well">\n  <a class="close" href="#" style="display: none;">&times;</a>\n  <div class="trigger">\n    <h1><a href="#" class="open">'+_("")+'</a></h1>\n  </div>\n\n  <div class="option_panel" style="display: none;">\n    <ul class="nav nav-pills">\n      <li class="active">\n        <a href="#" data-target="#options">'+_("Options")+'</a>\n      </li>\n      <li><a href="#" data-target="#help">'+_("Help")+'</a></li>\n      <li><a href="#" data-target="#about">'+_("About")+'</a></li>\n      <li style="display: none;" id="debug"><a href="#" data-target="#advanced">'+_("Advanced")+'</a></li>\n    </ul>\n    <div id="options" class="minipanel">\n      <form class="">\n        <label class="control-label" for="inputEmail">'+_("Dictionary")+'</label>\n        <select type="radio"\n               name="language_pair">\n        '+makeLanguageOption(opts.dictionaries)+'\n        </select>\n        <br />\n        <button type="submit" class="btn" id="save">'+_("Save")+'</button>\n      </form>\n    </div>\n    <div id="advanced" style="display: none;" class="minipanel">\n      <br />\n      <strong>Advanced settings</strong>\n      <p>This deletes all stored settings, dictionary names, and translations of the application.</p>\n      <a href="#" type="submit" class="btn btn-small" id="refresh_settings">'+_("Refresh settings")+"</a>\n      <br />\n      <br />\n      <strong>Hostname:</strong>\n      <blockquote><pre>"+API_HOST+'</pre></blockquote>\n      <strong>Alerts:</strong>\n      <p>Display an alert for debugging.</p>\n      <a href="#" type="submit" class="btn btn-small" id="display_update_window">'+_("Update detected")+'</a>\n      <a href="#" type="submit" class="btn btn-small" id="display_ie8_warning_window">'+_("IE8 Warning")+'</a>\n      <br />\n      <br />\n    </div>\n    <div id="help" style="display: none;" class="minipanel">\n        <p>'+_("In order to look up a word, hold down the <em>Alt</em> or <em>Option</em> () key, and doubleclick on a word. The service will contact the dictionary, and return a word after a short pause.")+"</p>\n        <p> </p>\n        <p>"+_('If you find a bug, or if the bookmark does not work on a specific page <a href="mailto:giellatekno@hum.uit.no">please contact us</a>. Tell us what page didn\'t work, or what you did when you discovered the problem.')+'\n        </p>\n    </div>\n    <div id="about" style="display: none;" class="minipanel">\n        <p>'+_("This tool was made by Giellatekno at UiT: The Arctic University of Norway.")+'</p>\n\n        <ul id="about-links" class="nav nav-tabs nav-stacked">\n          <li><a href="http://sanit.oahpa.no/about/">'+_("Read more")+'</a></li>\n          <li><a href="http://oahpa.no">'+_("More tools")+"</a></li>\n        </ul>\n    </div>\n  </div>\n</div>");el.find("ul.nav-pills a").click(function(evt){var target_element;target_element=$(evt.target).attr("data-target");el.find("ul.nav-pills a").parent("li").removeClass("active");$(evt.target).parent("li").addClass("active");el.find("div.minipanel").hide();el.find(target_element).show();return false});el.find(".trigger").click(function(){var optsp;optsp=el.find("div.option_panel");optsp.toggle();el.find("a.close").toggle();return false});el.find("a.close").click(function(){var optsp;optsp=el.find("div.option_panel");optsp.toggle();el.find("a.close").toggle();return false});el.find("button#save").click(function(){var optsp;optsp=el.find("div.option_panel");optsp.toggle();el.find("a.close").toggle();return false});el.find("a#refresh_settings").click(function(){DSt.set(NDS_SHORT_NAME+"-"+"digisanit-select-langpair",null);DSt.set(NDS_SHORT_NAME+"-"+"nds-languages",null);DSt.set(NDS_SHORT_NAME+"-"+"nds-localization",null);DSt.set(NDS_SHORT_NAME+"-"+"nds-stored-config",null);el.find("#advanced").append($("<p />").html("Reload the plugin..."));delete window.lookup_regex;return false});el.find("a#display_update_window").click(function(){window.newVersionNotify();return false});el.find("a#display_ie8_warning_window").click(function(){window.ie8Notify();return false});el.find('select[name="language_pair"]').change(function(e){var store_val;store_val=$(e.target).val();DSt.set(NDS_SHORT_NAME+"-"+"digisanit-select-langpair",store_val);delete window.lookup_regex;return true});el.find("form").submit(function(){var optsp;optsp=el.find("div.option_panel");optsp.toggle();el.find("a.close").toggle();return false});return el};Templates.prototype.ErrorBar=function(args){var el,host;host=args.host;el=$('<div id="nds_errors" class="errornav navbar-inverse navbar-fixed-bottom">\n  <div class="navbar-inner">\n    <div class="container">\n      <p><strong>'+_("Error!")+"</strong> "+_("Could not connect to dictionary server")+" (host: "+host+').\n         <a href="#" class="dismiss">'+_("Close")+"</a>.</p>\n    </div>\n  </div>\n</div>");el.find("a.dismiss").click(function(){$("body .errornav").remove();return false});return el};return Templates}()}});require.register({"src/jquery.neahttadigisanit":function(exports,require,module){var DSt,DictionaryAPI,JQZIndex,Selection,Semver,SpinnerHex,Templates,selectionizer,templates,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};Templates=require("./templates");Selection=require("./selection");DictionaryAPI=require("./dictionary");DSt=require("./DSt").DSt;Semver=require("../lib/semver");JQZIndex=require("lib/jquery.topZindex");selectionizer=new Selection;templates=new Templates;SpinnerHex="data:image/gif;base64,R0lGODlhIAAgALMAAOLi4tbW1sXFxbm5ubW1tZiYmIiIiFZWVjU1NR0dHQQEBP///wAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCgALACwAAAAAIAAgAAAE53DJSWlRperNZ1JJFQCdRhiVolICQZQUkCQHpSoT4A4wNScvyW0ycAV6E8MMMRkuAjskBTFDLZwuAkkqIfxIQyhBQBFvFwQEIjM5VDW6XNE4KagRh6Agwe60smQUB3d4Rz1ZBANnFASDd0hihh12CEE9kjAAVlycXIg7AAIFBqSlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YAvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gvqXGLDaC457D1zZ/V/nmOM82XiHQDYKhKP1oZmADdEAAAh+QQFCgALACwAAAAAGAAXAAAEcXDJSWsiNeuJEqpGsYlUYlKIomjIV55SoSZs+9JSohpa0R4TE84w2ywOLZJwEVApSJuWa3lQuZgGw6Biy8gEk0E2G5AEEBgjhTAOAdSbQJsH34gN4Loxre/DAQMEgoN+C4GDhH6AiIKFjo+QkZJGeXoRACH5BAUKAAsALAAAAAAeAA4AAAR1cMlJKUE16y0POhnBUcFQISh1JMk4GYY4oZhEsLULG8GcSgiWazLY+XK44aQAMy1oCwArIZsAOAHjM2VggV4KRSFKGPSWsCqlJSkkwgrDIkCoD65Rg2AkQMAVOQJ1dXtKf1QVAAODTjphcht0BGdDB5RYShwRACH5BAUKAAsALAcAAAAZABEAAARncMm5hBE0611Myd+2AEFmnBmCiASBTadBqeLSEgCMSocaaoHWQCdbFFSH2mLQKi1iEtVKCbhJoAtaJpEgUARNDQHhHHMTYmftcE4klZv2FM7h0uGG3H3P1yj+gAk/e4CFCn0LhgqCEQAh+QQFCgALACwOAAAAEgAYAAAEZTCUsKq9mBS8BuVLIV6FYYDhWAXmCYpb1Q4oXA0tmsbt944EU6xSQCBQAgPAcjAihiCK86irTA/VixGa7Xq7ibCYqhObE9VzAkH4fg2+rkGhcHXp9AQXJEDgFWRVBQl4dllzCm0RACH5BAUKAAsALA4AAAASAB4AAAR+EAywqr2YkIEFvhoBFsVXhRcpmuhJeqxWCWRpLm19nzJdrJWBwRAwBYCB4ZCzAxSUBtsOStxZBEtrRsvtIr7gA9AELiOsZsShy7ZQ2IVEoi2XI8a3wKGeWJsMCjAECHUmBwoKZxeEJgCIClJagApzbAmIBmwEj20IiG9dUSYRACH5BAUKAAsALA8AAQARAB8AAAR7cMm5AqAYC0KyB5wncoFIBdxgUhxxrRUnnNxL2QswtKW5tTNTizDAeVCEHqyybJoM0Ggh6IlaDc/r1MltEhCIQhMMPjjJCFEhQTmQxRRDImGeFMAShV4yT3Q8egoTc2mAexIIcyKBFH2GghMHihmMGH8YCQpsTQUKcEsRACH5BAUKAAsALAgADgAYABIAAARscMlJ6yI4D2D7zODgeSC2jWiKEioqGIbYWnAdzBRQ1EYxE4jbIsCTLQQKQweBqAxgwgVCoTgsElgJszkqUBUcbEJSYFo9CarympUcmD4adSwRU7adtCLOpk+YHVRcdW0TfBU7FQgJgzgffioRACH5BAUKAAsALAIAEgAdAA4AAAR4cMlJq13h0nC0DQSRXYaiGB41hMQAUERimiklsIQgIbOC6B6B4bUArEKBkilRkASYFoLB0JwEVoCCCTU5JBIohFgyNYwsxEnsuxsvBuXaBMFuIyaF6UC++N7tVnE1dAkEc24SeVwpXx2HfxMDZx6GFQcIjnxykDURACH5BAUKAAsALAAADwAZABEAAARnsCRF67o461u72mAmeV9onugJGCmaJEULIu8rZ0edHGhAbDXE7yLc+AiCDMGmQSAuhuiFQAWgnM9FlLU4Dk4HZ0wrvQyogVDByYOWFwDqcJZ1cy8Caoid2WoCVmoaBQZjNxoCBkkbEQAh+QQFCgALACwAAAgAEgAYAAAEXHARpcy6OGdDVSpaeCGdggiiViRlGnKVGwaWbN94ru+8XiCI3AEIvBGDAdkPeMAADCgREIQpGAwECSGbol0vW67oahiAt6kBGRNOkZNnseYqb4sC8sWAYM4BBgARACH5BAkKAAsALAAAAAAgACAAAASDcMlJq704612L4WClKEhojgphgsaYrGAyfrBWoEE9JSWFjAedJEFEqBYCBU14IBIPOWGFgHC+pBdiAXsBcL8awgFBLn/L6B5WnFaD32G4ZGAwCN6Buh7s0Re8XHR1BXcSBIA6eQYDFAIEBFFgAI9HbwOPkV8Bj4xwl4dyj4VwAJlyWBEAOw==";jQuery(document).ready(function($){var API_HOST,EXPECT_BOOKMARKLET_VERSION,cleanTooltipResponse,dictionary,first,getHostShortname,initSpinner,lookupSelectEvent,_,_this=this;_=module.fakeGetText;getHostShortname=function(url_path){var host,url;url=document.createElement("a");url.href=url_path;host=url.hostname;if(host){return host.split(".")[0]}return false};first=function(somearray){if(somearray.length>0){return somearray[0]}else{return false}};API_HOST=window.NDS_API_HOST||window.API_HOST;window.NDS_SHORT_NAME=getHostShortname(API_HOST);window.nds_exports={};EXPECT_BOOKMARKLET_VERSION="0.0.3";initSpinner=function(){var spinner,spinnerExists;spinnerExists=$(document).find(".spinner");if(spinnerExists.length===0){spinner=$('<img src="'+SpinnerHex+'" class="spinner" />');$(document).find("body").append(spinner);return spinner}return spinnerExists};$.ajaxSetup({timeout:10*1e3,beforeSend:function(args){var spinner;spinner=initSpinner();return spinner.show()},complete:function(args){var spinner;spinner=initSpinner();return spinner.hide()},dataType:"json",cache:true,error:function(){$(document).find("body").find(".errornav").remove();return $(document).find("body").append(templates.ErrorBar({host:API_HOST}))}});dictionary=new DictionaryAPI({host:"/"});cleanTooltipResponse=function(selection,response,opts){var element,range,string,_wrapElement;string=selection.string;element=selection.element;range=selection.range;if(opts.tooltip){_wrapElement=$('<a style="font-style: italic; border: 1px solid #CEE; padding: 0 2px" \n   class="tooltip_target">'+string+"</a>")[0];selectionizer.surroundRange(range,_wrapElement)}return templates.renderPopup(response,selection)};lookupSelectEvent=function(evt,string,element,range,opts,full_text){var langpair,lookup_string,mws,post_data,response_func,result_elem,settings,source_lang,target_lang,uri,url,_cp,_max,_min,_ref,_this=this;result_elem=$(document).find(opts.formResults);string=$.trim(string);settings=NDS.$.fn.getCurrentDictOpts().settings;if(settings.multiword_lookups){if(string.length>120){console.log("DEBUG: string was too long.");console.log(string.length);return false}}else{if(string.length>60||string.search(" ")>-1){console.log("DEBUG: string was too long or contained spaces.");console.log(string.length);return false}}langpair=DSt.get(NDS_SHORT_NAME+"-"+"digisanit-select-langpair");_ref=langpair.split("-"),source_lang=_ref[0],target_lang=_ref[1];lookup_string=string;_cp=first(NDS.options.dictionaries.filter(function(e){return e.from.iso===source_lang&&e.to.iso===target_lang}));if(_cp!=null){uri=_cp.uri}else{uri=false}window.cp=_cp;post_data={lookup:lookup_string,lemmatize:true};if(settings.multiword_lookups){post_data.multiword=true;_min=settings.multiword_range[0];_max=settings.multiword_range[1];mws=selectionizer.getMultiwordPermutations(_min,_max);post_data.lookup=mws}url=""+opts.api_host+uri;response_func=function(response,textStatus){var selection;selection={string:string,element:element,range:range};return cleanTooltipResponse(selection,response,opts)};$.ajax({url:url,type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(post_data)}).done(response_func);return false};$.fn.selectToLookup=function(opts){var dismissed,extendLanguageOpts,extendLanguageOptsAndInit,fetchConfigs,ie8Notify,initializeWithSettings,newVersionNotify,old_ie,recallLanguageOpts,spinner,storeConfigs,uagent,url,version_ok,_ref,_this=this;opts=$.extend({},$.fn.selectToLookup.options,opts);NDS.options=opts;spinner=initSpinner();if(window.NDS_API_HOST||window.API_HOST){window.API_HOST=window.NDS_API_HOST||window.API_HOST;if(/\/$/.test(window.API_HOST)){window.API_HOST=window.API_HOST.slice(0,window.API_HOST.length-1)}}if(NDS.options.api_host){if(/\/$/.test(NDS.options.api_host)){NDS.options.api_host=NDS.options.api_host.slice(0,NDS.options.api_host.length-1)}window.API_HOST=NDS.options.api_host}window.NDS_SHORT_NAME=getHostShortname(NDS.options.api_host);newVersionNotify=function(){$.getJSON(NDS.options.api_host+"/read/update/json/"+"?callback=?",function(response){$(document).find("body").append(templates.NotifyWindow(response));$(document).find("#notifications").modal({backdrop:true,keyboard:true});return $("#close_modal").click(function(){$("#notifications").modal("hide");DSt.set(NDS_SHORT_NAME+"-"+"digisanit-select-langpair",null);DSt.set(NDS_SHORT_NAME+"-"+"nds-languages",null);DSt.set(NDS_SHORT_NAME+"-"+"nds-localization",null);DSt.set(NDS_SHORT_NAME+"-"+"nds-stored-config",null);window.location.reload();return false})});return false};window.newVersionNotify=newVersionNotify;ie8Notify=function(){$.getJSON(NDS.options.api_host+"/read/ie8_instructions/json/"+"?callback=?",function(response){$(document).find("body").prepend(templates.NotifyWindow(response));$(document).find("#notifications").modal({backdrop:true,keyboard:true});return $("#close_modal").click(function(){$("#notifications").modal("hide");DSt.set(NDS_SHORT_NAME+"-"+"nds-ie8-dismissed",true);return false})});return true};window.ie8Notify=ie8Notify;initializeWithSettings=function(){var clean,holdingOption,previous_langpair,_from,_opt,_ref,_select,_to,_this=this;delete window.lookup_regex;if(NDS.options.displayOptions){$(document).find("body").append(templates.OptionsTab(NDS.options));window.optTab=$(document).find("#webdict_options");window.optTab.css("z-index",9e3);$(document).find("#webdict_options").topZIndex();$(document).find("#lessbuttons_holder").css({"z-index":5e3})}previous_langpair=DSt.get(NDS_SHORT_NAME+"-"+"digisanit-select-langpair");if(previous_langpair){_select="select[name='language_pair']";_opt=window.optTab.find(_select).val(previous_langpair)}else{if(NDS.options.default_language_pair){_ref=NDS.options.default_language_pair,_from=_ref[0],_to=_ref[1];_select="select[name='language_pair'] option[value='"+_from+"-"+_to+"']";_opt=window.optTab.find(_select).val();previous_langpair=DSt.set(NDS_SHORT_NAME+"-"+"digisanit-select-langpair",_opt)}else{_select="select[name='language_pair']";_opt=window.optTab.find(_select).val();previous_langpair=DSt.set(NDS_SHORT_NAME+"-"+"digisanit-select-langpair",_opt)}}holdingOption=function(evt){var element,full_text,range,string,within_options,_ref1;clean(evt);if(evt.altKey){element=evt.target;within_options=$(element).parents("#webdict_options");if(within_options.length>0){$(within_options[0]).find("#debug").show();return false}_ref1=selectionizer.getFirstRange(),range=_ref1[0],full_text=_ref1[1];string=selectionizer.cloneContents(range);if(range&&string){lookupSelectEvent(evt,string,element,range,NDS.options,full_text)}return false}return true};clean=function(event){var parents;parents=[];$(document).find("a.tooltip_target").each(function(){parents.push($(this).parent());$(this).popover("destroy");return $(this).replaceWith(this.childNodes)});$(document).find("a.tooltip_target").contents().unwrap();return selectionizer.cleanRange()};window.cleanTooltips=clean;return $(document).bind("click",holdingOption)};storeConfigs=function(response){DSt.set(NDS_SHORT_NAME+"-"+"nds-languages",response.dictionaries);DSt.set(NDS_SHORT_NAME+"-"+"nds-localization",response.localization);DSt.set(NDS_SHORT_NAME+"-"+"nds-stored-config","true");return true};extendLanguageOpts=function(response){window.r_test=response;NDS.options.dictionaries=response.dictionaries;NDS.options.localization=response.localization;NDS.options.default_language_pair=response.default_language_pair;storeConfigs(response)};fetchConfigs=function(){var url;url=""+opts.api_host+"/read/config/";return $.getJSON(url+"?callback=?",extendLanguageOpts)};extendLanguageOptsAndInit=function(response){extendLanguageOpts(response);return initializeWithSettings()};recallLanguageOpts=function(){var locales;locales=DSt.get(NDS_SHORT_NAME+"-"+"nds-localization");if(typeof locales==="string"){locales=JSON.parse(locales)}NDS.options.localization=locales;return initializeWithSettings()};version_ok=false;if(window.NDS_BOOKMARK_VERSION!=null){version_ok=Semver.gte(window.NDS_BOOKMARK_VERSION,EXPECT_BOOKMARKLET_VERSION)}else{version_ok=true}uagent=navigator.userAgent;_ref=[false,false],old_ie=_ref[0],dismissed=_ref[1];if(__indexOf.call(uagent,"MSIE 8.0")>=0){old_ie=true;dismissed=DSt.get(NDS_SHORT_NAME+"-"+"nds-ie8-dismissed")}if(version_ok){if(old_ie){console.log("ie8 detected");if(!dismissed){ie8Notify()}}url=""+opts.api_host+"/read/config/";$.getJSON(url+"?callback=?",extendLanguageOptsAndInit);return false}else{newVersionNotify();return false}};$.fn.getOptsForDict=function(_from,_to){var dict,_i,_len,_ref;_ref=NDS.options.dictionaries;for(_i=0,_len=_ref.length;_i<_len;_i++){dict=_ref[_i];if(dict.from.iso===_from&&dict.to.iso===_to){return dict}}};$.fn.getCurrentDictOpts=function(){var pair,_from,_ref,_to;pair=DSt.get(NDS_SHORT_NAME+"-"+"digisanit-select-langpair");_ref=pair.split("-"),_from=_ref[0],_to=_ref[1];return NDS.$.fn.getOptsForDict(_from,_to)};return $.fn.selectToLookup.options={api_host:API_HOST,formResults:"#results",sourceLanguage:"sme",langPairSelect:"#webdict_options *[name='language_pair']",tooltip:true,languageWordOptions:false,displayOptions:true,dictionaries:[{from:{iso:"sme",name:"nordsamisk"},to:{iso:"nob",name:"norsk"},uri:"/lookup/sme/nob/"}]}})}});require.register({"lib/jquery.topZindex":function(exports,require,module){(function($){$.topZIndex=function(selector){return Math.max(0,Math.max.apply(null,$.map((selector||"*")==="*"?$.makeArray(document.getElementsByTagName("*")):$(selector),function(v){return parseFloat($(v).css("z-index"))||null})))};$.fn.topZIndex=function(opt){if(this.length===0){return this}opt=$.extend({increment:1},opt);var zmax=$.topZIndex(opt.selector),inc=opt.increment;return this.each(function(){$(this).css({"z-index":zmax+=inc})})}})(jQuery);$.maxZIndex=$.fn.maxZIndex=function(opt){var def={inc:10,group:"*"};$.extend(def,opt);var zmax=0;$(def.group).each(function(){var cur=parseInt($(this).css("z-index"));zmax=cur>zmax?cur:zmax});if(!this.jquery)return zmax;return this.each(function(){zmax+=def.inc;$(this).css("z-index",zmax)})}}});require.register({"src/localization":function(exports,require,module){var fakeGetText;module.exports=fakeGetText=function(string){var localized;if(NDS.options.localization!=null){localized=NDS.options.localization[string];if(localized!=null){if(localized){return localized}}}return string}}});(function(){var Application;Application=require("src/application");window.NDS=new Application})();
}).call(this);
// End global NDS space
